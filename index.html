<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VMCTK Digital Library</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root {
      --bg-light: #f3f4f6;
      --bg-dark: #1f2937;
      --text-light: #1f2937;
      --text-dark: #f9fafb;
      --accent: #3b82f6;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-light);
      color: var(--text-light);
      transition: background-color 0.6s ease, color 0.6s ease;
    }
    body.dark { background-color: var(--bg-dark); color: var(--text-dark); }

    /* ===== LOADING SCREEN ===== */
    #loadingScreen {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white; display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      font-size: 1.2rem; z-index: 100;
      transition: opacity 0.8s ease-out, background 0.6s ease;
    }
    body.dark #loadingScreen {
      background: linear-gradient(135deg, #111827, #1f2937);
    }
    #loadingScreen.fade-out { opacity: 0; visibility: hidden; }

    .spinner {
      border: 4px solid rgba(255,255,255,0.3);
      border-top: 4px solid white;
      border-radius: 50%; width: 40px; height: 40px;
      animation: spin 1s linear infinite;
      margin-bottom: 1rem; transition: border-color 0.6s ease;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    body.dark .spinner {
      border: 4px solid rgba(255,255,255,0.15);
      border-top: 4px solid #9ca3af;
    }
    #quoteText { transition: opacity 1s ease-in-out, color 0.6s ease; }
    body.dark #quoteText { color: #e5e7eb; }

    /* ===== BOOK CARDS ===== */
    .book-card {
      background-color: white; border-radius: 1rem;
      padding: 1rem; text-align: center;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .book-card:hover { transform: scale(1.03); box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
    body.dark .book-card { background-color: #374151; color: #f9fafb; }

    .book-cover { width: 100%; height: auto; border-radius: 0.75rem; object-fit: contain; }

    /* ===== FEATURED CAROUSEL ===== */
    #featuredList { display: flex; gap: 1.5rem; overflow-x: auto; scroll-smooth: true; padding-bottom: 0.5rem; }
    #featuredList::-webkit-scrollbar { height: 8px; }
    #featuredList::-webkit-scrollbar-thumb { background: #facc15; border-radius: 10px; }

    .featured-card {
      min-width: 250px; flex: 0 0 auto; border: 2px solid #facc15;
      background-color: rgba(250, 204, 21, 0.1);
      border-radius: 1rem; animation: pulseGlow 2s infinite;
      cursor: pointer; transition: transform 0.3s;
    }
    .featured-card:hover { transform: scale(1.05); }
    @keyframes pulseGlow {
      0%,100% { box-shadow: 0 0 10px rgba(250,204,21,0.4); }
      50% { box-shadow: 0 0 25px rgba(250,204,21,0.8); }
    }

    /* ===== MODAL ===== */
    .modal { display: none; position: fixed; z-index: 50; inset: 0;
      background-color: rgba(0,0,0,0.6);
      justify-content: center; align-items: center; }
    .modal.show { display: flex; animation: fadeIn 0.4s ease forwards; }
    @keyframes fadeIn { from{opacity:0; transform:scale(0.95);} to{opacity:1; transform:scale(1);} }

    .modal-content {
      background: white; border-radius: 1rem; max-width: 28rem;
      padding: 1.5rem; text-align: center; position: relative;
    }
    body.dark .modal-content { background: #374151; color: #f9fafb; }

    .close-btn { position: absolute; top: 0.5rem; right: 0.75rem; background: #ef4444; color: white; border: none; border-radius: 0.5rem; padding: 0.3rem 0.6rem; cursor: pointer; }

    #tooltipHint { transition: opacity 0.6s ease-in-out; }

    /* ===== ABOUT SECTION ===== */
    #aboutVMCTK a:hover img.w-5 { transform: scale(1.1); transition: transform 0.3s; }
  </style>
</head>

<body>
  <!-- ğŸ“š Loading Screen -->
  <div id="loadingScreen">
    <div class="spinner"></div>
    <p>ğŸ“š Loading VMCTK Digital Library...</p>
    <p id="quoteText" class="mt-3 text-center text-sm italic opacity-90"></p>
  </div>

  <!-- ğŸŒŸ Header -->
  <header class="bg-white dark:bg-gray-800 shadow p-4 flex flex-col items-center relative transition-colors duration-300">
    <button id="themeToggle" title="Toggle dark mode" class="absolute top-4 right-4">ğŸŒ™</button>
    <img id="logoImage" src="LOGO VMC.png" class="w-24 mb-2 transition duration-300 ease-in-out opacity-100">
    <h1 class="text-2xl font-bold text-center">VMCTK Digital Library</h1>
    <p id="subtitle" class="text-gray-500 dark:text-gray-300 text-center">Volunteer for My Community</p>
    <div class="mt-2">
      <button id="enBtn" class="px-3 py-1 bg-blue-500 text-white rounded">English</button>
      <button id="khBtn" class="px-3 py-1 bg-gray-300 ml-2 rounded">ááŸ’á˜áŸ‚áš</button>
    </div>
  </header>

  <!-- ğŸ” Search -->
  <section class="p-4 flex justify-center">
    <input id="searchInput" type="text" placeholder="Search books..." class="w-full max-w-xl p-2 border rounded shadow">
  </section>

  <!-- â­ Featured Carousel -->
  <section id="featuredSection" class="p-4 hidden">
    <div class="flex justify-between items-center mb-3">
      <h2 class="text-2xl font-bold text-yellow-500">â­ Featured Books</h2>
      <div>
        <button id="scrollLeft" class="text-yellow-400 text-2xl hover:text-yellow-300">â—€</button>
        <button id="scrollRight" class="text-yellow-400 text-2xl hover:text-yellow-300 ml-2">â–¶</button>
      </div>
    </div>
    <div id="featuredList"></div>
  </section>

  <!-- ğŸ“˜ All Books -->
  <section id="bookList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 p-4"></section>

  <!-- ğŸ“– Modal -->
  <div id="bookModal" class="modal">
    <div class="modal-content">
      <button id="closeModal" class="close-btn">âœ•</button>
      <img id="modalCover" src="" alt="Book Cover">
      <h2 id="modalTitle" class="font-bold text-lg mb-1"></h2>
      <p id="modalAuthor" class="text-gray-600 mb-1"></p>
      <p id="modalLang" class="text-blue-500 mb-3"></p>
      <p id="modalDesc" class="text-gray-700 mb-4"></p>
      <div class="flex justify-between">
        <a id="modalRead" href="#" target="_blank" class="text-green-600 font-semibold">Read Online</a>
        <a id="modalDownload" href="#" download class="text-blue-600 font-semibold">Download</a>
      </div>
      <div class="flex justify-between mt-4">
        <button id="prevBook" class="px-4 py-1 bg-blue-500 text-white rounded">â® Prev</button>
        <button id="nextBook" class="px-4 py-1 bg-blue-500 text-white rounded">Next â­</button>
      </div>
      <p id="tooltipHint" class="text-sm text-gray-400 mt-3 opacity-0 text-center">ğŸ’¡ Tip: Use â† â†’ keys to browse books</p>
    </div>
  </div>

  <!-- â¤ï¸ About Section (Bilingual) -->
  <section id="aboutVMCTK" class="mt-12 px-6 py-10 bg-gradient-to-r from-blue-100 to-indigo-100 dark:from-gray-800 dark:to-gray-900 text-center transition-all duration-700">
    <img src="LOGO VMC.png" class="w-20 mx-auto mb-4 dark:hidden">
    <img src="LOGO_VMC_white.png" class="w-20 mx-auto mb-4 hidden dark:block">

    <div id="aboutEN">
      <h2 class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-3">About VMCTK</h2>
      <p class="max-w-2xl mx-auto text-gray-700 dark:text-gray-300 text-lg leading-relaxed">
        <strong>VMCTK Digital Library</strong> is a volunteer project by
        <em>Volunteer for My Community</em>, dedicated to helping
        <span class="text-blue-500 dark:text-blue-300 font-medium">youths access free books</span>
        in both <span class="font-semibold">English</span> and
        <span class="font-semibold">Khmer</span>.
      </p>
      <p class="mt-4 italic text-gray-600 dark:text-gray-400">
        â€œEmpowering youths through free knowledge and community spirit.â€ ğŸŒ±
      </p>
    </div>

    <div id="aboutKH" class="hidden">
      <h2 class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-3">á¢áŸ†á–á¸ VMCTK</h2>
      <p class="max-w-2xl mx-auto text-gray-700 dark:text-gray-300 text-lg leading-relaxed">
        <strong>á”ááŸ’áá¶á›áŸá™áŒá¸á‡á¸áá› VMCTK</strong> á‚áºá‡á¶á‚á˜áŸ’ášáŸ„á„áŸáŸ’á˜áŸá‚áŸ’ášá…á·ááŸ’ááŠáŸ„á™
        <em>Volunteer for My Community</em> áŠáŸ‚á›á˜á¶á“á”áŸ†áá„á‡á½á™á²áŸ’á™
        <span class="text-blue-500 dark:text-blue-300 font-medium">á™á»áœá‡á“á¢á¶á…á…á¼á›áŠáŸ†áá¾ášá€á¶ášáŸáŸ€áœá—áŸ…á¥áá‚á·áááŸ’á›áŸƒ</span>
        á‘á¶áŸ†á„ <span class="font-semibold">á—á¶áŸá¶á¢á„áŸ‹á‚áŸ’á›áŸáŸ</span> á“á·á„
        <span class="font-semibold">á—á¶áŸá¶ááŸ’á˜áŸ‚áš</span>áŸ”
      </p>
      <p class="mt-4 italic text-gray-600 dark:text-gray-400">
        â€œá•áŸ’áá›áŸ‹á¢áŸ†áá¶á…áŠá›áŸ‹á™á»áœá‡á“áá¶á˜ášá™áŸˆá…áŸ†ááŸáŸ‡áŠá¹á„ á“á·á„áŸáŸ’á˜á¶ášáá¸áŸá á‚á˜á“áŸáŸ”â€ ğŸŒ±
      </p>
    </div>

    <div class="mt-6 flex justify-center flex-wrap gap-4">
      <a href="https://www.facebook.com/profile.php?id=61576745039709" target="_blank"
         class="px-4 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition flex items-center gap-2">
         <img src="https://cdn-icons-png.flaticon.com/512/733/733547.png" class="w-5 h-5"> Facebook
      </a>
      <a href="https://t.me/+exCdScgzKltlN2Zl" target="_blank"
         class="px-4 py-2 bg-sky-500 text-white rounded-lg shadow hover:bg-sky-600 transition flex items-center gap-2">
         <img src="https://cdn-icons-png.flaticon.com/512/2111/2111646.png" class="w-5 h-5"> Telegram
      </a>
      <a href="tel:+855969986500"
         class="px-4 py-2 border border-green-600 text-green-700 dark:text-green-400 rounded-lg hover:bg-green-600 hover:text-white transition flex items-center gap-2">
         <img src="https://cdn-icons-png.flaticon.com/512/597/597177.png" class="w-5 h-5"> +855 96 998 6500
      </a>
    </div>
  </section>

  <!-- ğŸŒ Footer -->
  <footer class="bg-gray-800 text-white text-center p-4 mt-8 transition-colors duration-300">
    <p id="footerText">Â© 2025 VMCTK Digital Library â€” All books are free for learning</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS75RiAFZNe61Mrh8jhMpnYX-o0XaJynvA2Ho2kfDBzrkeA1ewCftd90oZ2WDIAmeTvHX5c1uKoxIGU/pub?output=csv";
    const loadingScreen = document.getElementById("loadingScreen");

    // ğŸŒŸ Quotes
    const quotes = [
      "ğŸ“– A reader lives a thousand lives before he dies.",
      "ğŸŒ± Knowledge shared is knowledge multiplied.",
      "ğŸš€ The future belongs to those who learn today.",
      "ğŸ’¡ Small steps every day create big change.",
      "ğŸ¤ Sharing a book is sharing a world.",
      "ğŸ“š á¢áŸ’á“á€á¢á¶á“áŸáŸ€áœá—áŸ…á‚áºá‡á¶á¢áŸ’á“á€áŠá¹á€á“á¶áŸ†á“á¶á–áŸá›á¢á“á¶á‚ááŸ”",
      "ğŸŒ á€á¶ášá¢á¶á“áŸáŸ€áœá—áŸ…á‡á¶á‚á“áŸ’á›á„á‘áŸ…ášá€á–á“áŸ’á›áºá“áŸƒá…áŸ†ááŸáŸ‡áŠá¹á„áŸ”",
      "ğŸŒˆ Education is the most powerful weapon to change the world.",
      "â¤ï¸ Learn not for school, but for life.",
      "ğŸ“ Reading is dreaming with open eyes."
    ];

    function showRandomQuote() {
      const quoteEl = document.getElementById("quoteText");
      if (!quoteEl) return;
      let currentQuote = quotes[Math.floor(Math.random() * quotes.length)];
      quoteEl.textContent = currentQuote;
      setTimeout(() => {
        quoteEl.style.opacity = "0";
        setTimeout(() => {
          let newQuote;
          do { newQuote = quotes[Math.floor(Math.random() * quotes.length)]; }
          while (newQuote === currentQuote);
          quoteEl.textContent = newQuote;
          quoteEl.style.opacity = "1";
        }, 1000);
      }, 4000);
    }
    showRandomQuote();

    let books = [];
    let currentIndex = 0;

    function getHdCover(url) {
      if (!url) return "covers/placeholder.jpg";
      const match = url.match(/[-\w]{25,}/);
      return match ? `https://drive.google.com/thumbnail?id=${match[0]}&sz=w2000` : url;
    }

    async function loadBooks() {
      const response = await fetch(CSV_URL);
      const csvText = await response.text();
      const results = Papa.parse(csvText, { header: true });
      books = results.data.filter(b => b.Title);

      const container = document.getElementById("bookList");
      const featuredSection = document.getElementById("featuredSection");
      const featuredList = document.getElementById("featuredList");
      container.innerHTML = "";
      featuredList.innerHTML = "";

      const featuredBooks = books.filter(b => b.Featured && b.Featured.toLowerCase() === "yes").slice(0, 6);
      if (featuredBooks.length > 0) {
        featuredSection.classList.remove("hidden");
        featuredBooks.forEach(book => {
          const card = document.createElement("div");
          card.className = "featured-card p-4 text-center";
          card.innerHTML = `
            <img src="${getHdCover(book["Cover Link"])}" class="book-cover mb-2" />
            <h3 class="text-lg font-bold text-yellow-500">${book.Title}</h3>
            <p class="text-gray-600 dark:text-gray-300">${book.Author}</p>`;
          card.addEventListener("click", () => openModal(books.indexOf(book)));
          featuredList.appendChild(card);
        });
      }

      books.forEach((book, index) => {
        const card = document.createElement("div");
        card.className = "book-card";
        card.innerHTML = `
          <img src="${getHdCover(book["Cover Link"])}" class="book-cover" />
          <h2 class="font-bold text-lg mt-2">${book.Title}</h2>
          <p class="text-sm text-gray-500">${book.Author}</p>`;
        card.addEventListener("click", () => openModal(index));
        container.appendChild(card);
      });

      loadingScreen.classList.add("fade-out");
    }

    // modal
    const modal = document.getElementById("bookModal");
    const closeModalBtn = document.getElementById("closeModal");
    function openModal(index) {
      currentIndex = index;
      const b = books[index];
      document.getElementById("modalCover").src = getHdCover(b["Cover Link"]);
      document.getElementById("modalTitle").textContent = b.Title;
      document.getElementById("modalAuthor").textContent = b.Author;
      document.getElementById("modalLang").textContent = b.Language;
      document.getElementById("modalDesc").textContent = b.Description;
      document.getElementById("modalRead").href = b["PDF Link"];
      document.getElementById("modalDownload").href = b["PDF Link"];
      modal.classList.add("show");

      const tip = document.getElementById("tooltipHint");
      if (!sessionStorage.getItem("tipShown")) {
        tip.style.opacity = "1";
        setTimeout(() => (tip.style.opacity = "0"), 3000);
        sessionStorage.setItem("tipShown", "true");
      }
    }
    closeModalBtn.onclick = () => modal.classList.remove("show");
    window.onclick = e => { if (e.target === modal) modal.classList.remove("show"); };

    document.addEventListener("keydown", e => {
      if (!modal.classList.contains("show")) return;
      if (e.key === "ArrowRight") openModal((currentIndex + 1) % books.length);
      if (e.key === "ArrowLeft") openModal((currentIndex - 1 + books.length) % books.length);
      if (e.key === "Escape") modal.classList.remove("show");
    });

    // search
    document.getElementById("searchInput").addEventListener("input", e => {
      const term = e.target.value.toLowerCase();
      document.querySelectorAll("#bookList > div").forEach(book => {
        const title = book.querySelector("h2").textContent.toLowerCase();
        const author = book.querySelector("p").textContent.toLowerCase();
        book.style.display = title.includes(term) || author.includes(term) ? "block" : "none";
      });
    });

    // featured scroll + auto-scroll
    const featuredList = document.getElementById("featuredList");
    document.getElementById("scrollLeft").onclick = () => featuredList.scrollBy({ left: -300, behavior: "smooth" });
    document.getElementById("scrollRight").onclick = () => featuredList.scrollBy({ left: 300, behavior: "smooth" });
    let autoScrollActive = true;
    function autoScroll() {
      if (!autoScrollActive) return;
      featuredList.scrollBy({ left: 1, behavior: "smooth" });
      if (featuredList.scrollLeft + featuredList.clientWidth >= featuredList.scrollWidth - 1)
        featuredList.scrollTo({ left: 0, behavior: "smooth" });
    }
    setInterval(autoScroll, 40);
    ["mouseenter","touchstart"].forEach(ev => featuredList.addEventListener(ev, () => autoScrollActive=false));
    ["mouseleave","touchend"].forEach(ev => featuredList.addEventListener(ev, () => autoScrollActive=true));

    // language toggle for about + text
    const enBtn = document.getElementById("enBtn");
    const khBtn = document.getElementById("khBtn");
    const subtitle = document.getElementById("subtitle");
    const footerText = document.getElementById("footerText");

    enBtn.onclick = () => {
      subtitle.textContent = "Volunteer for My Community";
      footerText.textContent = "Â© 2025 VMCTK Digital Library â€” All books are free for learning";
      document.getElementById("aboutEN").classList.remove("hidden");
      document.getElementById("aboutKH").classList.add("hidden");
      enBtn.classList.add("bg-blue-500","text-white");
      khBtn.classList.remove("bg-blue-500","text-white");
      khBtn.classList.add("bg-gray-300");
    };
    khBtn.onclick = () => {
      subtitle.textContent = "á¢á¶á“áŸáŸ€áœá—áŸ…áŠáŸ„á™á¥áá‚á·áááŸ’á›áŸƒáŸá˜áŸ’ášá¶á”áŸ‹á™á»áœá‡á“";
      footerText.textContent = "Â© áŸ¢áŸ áŸ¢áŸ¥ á”ááŸ’áá¶á›áŸá™áŒá¸á‡á¸áá› VMCTK â€” áŸáŸ€áœá—áŸ…á‘á¶áŸ†á„á¢áŸáŸ‹á‚áºá¥áá‚á·áááŸ’á›áŸƒáŸá˜áŸ’ášá¶á”áŸ‹á€á¶ášáŸá·á€áŸ’áŸá¶";
      document.getElementById("aboutKH").classList.remove("hidden");
      document.getElementById("aboutEN").classList.add("hidden");
      khBtn.classList.add("bg-blue-500","text-white");
      enBtn.classList.remove("bg-blue-500","text-white");
      enBtn.classList.add("bg-gray-300");
    };

    // theme toggle
    const themeToggle = document.getElementById("themeToggle");
    const logoImage = document.getElementById("logoImage");
    if (localStorage.getItem("theme") === "dark") {
      document.body.classList.add("dark");
      themeToggle.textContent = "â˜€ï¸";
      logoImage.src = "LOGO_VMC_white.png";
    }
    themeToggle.onclick = () => {
      document.body.classList.toggle("dark");
      const isDark = document.body.classList.contains("dark");
      themeToggle.textContent = isDark ? "â˜€ï¸" : "ğŸŒ™";
      logoImage.src = isDark ? "LOGO_VMC_white.png" : "LOGO VMC.png";
      localStorage.setItem("theme", isDark ? "dark" : "light");
    };

    loadBooks();
  </script>
</body>
</html>
