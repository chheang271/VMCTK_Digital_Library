<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VMCTK Digital Library</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --vmc-blue: #1e40af;
      --vmc-light-blue: #3b82f6;
      --vmc-yellow: #facc15;
      --vmc-bg-light: #f3f4f6;
      --vmc-bg-dark: #111827;
      --vmc-text-light: #1f2937;
      --vmc-text-dark: #f9fafb;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--vmc-bg-light);
      color: var(--vmc-text-light);
      transition: background-color 0.6s ease, color 0.6s ease;
    }
    body.dark {
      background-color: var(--vmc-bg-dark);
      color: var(--vmc-text-dark);
    }

    /* âœ… Fix book title color in dark mode */
    body.dark h3 {
      color: #f9fafb;
      text-shadow: 0 0 6px rgba(255, 255, 255, 0.4);
    }

    /* Loading Screen */
    #loadingScreen {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, var(--vmc-light-blue), var(--vmc-blue));
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-size: 1.1rem;
      z-index: 100;
      transition: opacity 0.8s ease-out;
    }
    #loadingScreen.fade-out {
      opacity: 0;
      visibility: hidden;
    }
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid var(--vmc-yellow);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin-bottom: 1rem;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Header */
    header {
      background: linear-gradient(to right, var(--vmc-light-blue), var(--vmc-blue));
      color: white;
      transition: background-color 0.6s ease;
    }
    body.dark header {
      background: linear-gradient(to right, #1e293b, var(--vmc-bg-dark));
      color: var(--vmc-yellow);
    }

    #themeToggle {
      font-size: 1.4rem;
      color: var(--vmc-yellow);
    }

    /* Buttons */
    button, a {
      transition: background-color 0.3s, color 0.3s, transform 0.2s;
    }
    button:hover, a:hover {
      transform: scale(1.05);
    }

    #enBtn {
      background-color: var(--vmc-blue);
      color: white;
    }
    #khBtn {
      background-color: var(--vmc-yellow);
      color: black;
    }
    #enBtn:hover {
      background-color: var(--vmc-light-blue);
    }
    #khBtn:hover {
      background-color: #fbbf24;
    }

    /* Featured Carousel */
    #featuredSection {
      background: linear-gradient(to right, #e0f2fe, #fef9c3);
    }
    body.dark #featuredSection {
      background: linear-gradient(to right, #1e293b, #1f2937);
    }
    #featuredList {
      display: flex;
      gap: 1rem;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      scroll-behavior: smooth;
      padding: 0.5rem;
      -webkit-overflow-scrolling: touch;
    }
    #featuredList::-webkit-scrollbar {
      height: 6px;
    }
    #featuredList::-webkit-scrollbar-thumb {
      background: var(--vmc-yellow);
      border-radius: 10px;
    }
    .featured-card {
      flex: 0 0 85%;
      max-width: 300px;
      scroll-snap-align: center;
      border: 2px solid var(--vmc-yellow);
      background-color: rgba(250, 204, 21, 0.1);
      border-radius: 1rem;
      padding: 0.75rem;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .featured-card:hover {
      transform: scale(1.03);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    /* Modal / Glass */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(8px);
      justify-content: center;
      align-items: center;
      z-index: 50;
    }
    .modal.show {
      display: flex;
      animation: fadeIn 0.4s ease forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    .modal-content {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(10px);
      border-radius: 1rem;
      padding: 1.5rem;
      max-width: 26rem;
      width: 90%;
      text-align: center;
      border: 2px solid var(--vmc-blue);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }
    body.dark .modal-content {
      background: rgba(55, 65, 81, 0.85);
    }

    /* Footer */
    footer {
      background: linear-gradient(to right, var(--vmc-blue), var(--vmc-light-blue));
      color: white;
      transition: background-color 0.5s ease;
    }
    body.dark footer {
      background: linear-gradient(to right, var(--vmc-bg-dark), var(--vmc-bg-dark));
      color: var(--vmc-yellow);
    }

    footer a {
      color: inherit;
      text-decoration: none;
      transition: color 0.3s;
    }
    footer a:hover {
      color: var(--vmc-yellow);
    }
  </style>
</head>

<body>
  <!-- Loading -->
  <div id="loadingScreen">
    <div class="spinner"></div>
    <p>ğŸ“š Loading VMCTK Digital Library...</p>
    <p id="quoteText" class="mt-3 text-sm italic opacity-90"></p>
  </div>

  <!-- Header -->
  <header class="shadow p-4 flex flex-col items-center relative">
    <button id="themeToggle" class="absolute top-4 right-4">ğŸŒ™</button>
    <img id="logoImage" src="LOGO VMC.png" class="w-24 mb-2">
    <h1 class="text-2xl font-bold text-center">VMCTK Digital Library</h1>
    <p id="subtitle" class="text-gray-200 dark:text-gray-300 text-center">Volunteer for My Community</p>
    <div class="mt-2">
      <button id="enBtn" class="px-3 py-1">English</button>
      <button id="khBtn" class="px-3 py-1 ml-2">ááŸ’á˜áŸ‚áš</button>
    </div>
  </header>

  <!-- Search -->
  <section class="p-4 flex justify-center">
    <input id="searchInput" type="text" placeholder="Search books..." class="w-full max-w-xl p-2 border rounded shadow">
  </section>

  <!-- Featured -->
  <section id="featuredSection" class="p-4">
    <div class="flex justify-between items-center mb-3">
      <h2 class="text-xl sm:text-2xl font-bold text-yellow-500 tracking-wide">â­ Featured Books</h2>
      <div>
        <button id="scrollLeft" class="text-yellow-400 text-2xl hover:text-yellow-300">â—€</button>
        <button id="scrollRight" class="text-yellow-400 text-2xl hover:text-yellow-300 ml-2">â–¶</button>
      </div>
    </div>
    <div id="featuredList"></div>
  </section>

  <!-- Book List -->
  <section id="bookList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 p-4"></section>

  <!-- Modal -->
  <div id="bookModal" class="modal">
    <div class="modal-content relative">
      <button id="closeModal" class="absolute top-2 right-3 bg-red-500 text-white rounded px-2">âœ•</button>
      <img id="modalCover" src="" alt="Book Cover" class="mx-auto rounded-lg shadow">
      <h2 id="modalTitle" class="font-bold text-lg mt-2"></h2>
      <p id="modalAuthor" class="text-gray-600 mb-1"></p>
      <p id="modalLang" class="text-yellow-500 mb-3"></p>
      <p id="modalDesc" class="text-gray-700 mb-4"></p>
      <div class="flex justify-between">
        <a id="modalRead" href="#" target="_blank" class="text-green-600 font-semibold">Read Online</a>
        <a id="modalDownload" href="#" download class="text-blue-600 font-semibold">Download</a>
      </div>
    </div>
  </div>
  <!-- About Section -->
  <section id="aboutVMCTK" class="px-6 py-10 bg-gradient-to-r from-blue-100 to-indigo-100 dark:from-gray-800 dark:to-gray-900 text-center">
    <img src="LOGO VMC.png" class="w-20 mx-auto mb-4 dark:hidden">
    <img src="LOGO_VMC_white.png" class="w-20 mx-auto mb-4 hidden dark:block">
    <div id="aboutEN">
      <h2 class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-3">About VMCTK</h2>
      <p class="max-w-2xl mx-auto text-gray-700 dark:text-gray-300 text-lg leading-relaxed">
        <strong>VMCTK Digital Library</strong> is a volunteer project by
        <em>Volunteer for My Community</em>, helping youths access
        <span class="text-blue-500 dark:text-blue-300 font-medium">free books</span> in
        <span class="font-semibold">English</span> and <span class="font-semibold">Khmer</span>.
      </p>
    </div>
    <div id="aboutKH" class="hidden">
      <h2 class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-3">á¢áŸ†á–á¸ VMCTK</h2>
      <p class="max-w-2xl mx-auto text-gray-700 dark:text-gray-300 text-lg leading-relaxed">
        <strong>á”ááŸ’áá¶á›áŸá™áŒá¸á‡á¸áá› VMCTK</strong> á‚áºá‡á¶á‚á˜áŸ’ášáŸ„á„áŸáŸ’á˜áŸá‚áŸ’ášá…á·ááŸ’á
        <em>Volunteer for My Community</em> áŠá¾á˜áŸ’á”á¸á‡á½á™
        <span class="text-blue-500 dark:text-blue-300 font-medium">á™á»áœá‡á“á¢á¶á“áŸáŸ€áœá—áŸ…á¥áá‚á·áááŸ’á›áŸƒ</span>áŸ”
      </p>
    </div>
  </section>

  <!-- Contact -->
  <section id="contactSection" class="px-6 py-10 bg-gradient-to-r from-indigo-100 to-blue-100 dark:from-gray-900 dark:to-gray-800 text-center">
    <div id="contactEN">
      <h2 class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-3">ğŸ“¬ Contact Us</h2>
      <p class="text-gray-700 dark:text-gray-300 mb-6">
        Have a question, suggestion, or want to volunteer? Weâ€™d love to hear from you!
      </p>
    </div>
    <div id="contactKH" class="hidden">
      <h2 class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-3">ğŸ“¬ á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„á˜á€á™á¾á„</h2>
      <p class="text-gray-700 dark:text-gray-300 mb-6">
        á˜á¶á“áŸáŸ†áá½áš á¬á…á„áŸ‹á…á¼á›ášá½á˜á‡á½á™áŸáŸ’á˜áŸá‚áŸ’ášá…á·ááŸ’áá˜áŸ‚á“á‘áŸ? á™á¾á„ášá¸á€ášá¶á™áŸáŸ’áá¶á”áŸ‹á–á¸á¢áŸ’á“á€áŸ”
      </p>
    </div>
    <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSe4MTbFG2ZmE-9JYGccFdh3yWlW-x7Fbck1DXAIafONQk_vUA/viewform?embedded=true"
      width="100%" height="600" frameborder="0"
      class="rounded-lg shadow-lg max-w-3xl mx-auto"></iframe>
  </section>

  <!-- Footer -->
  <footer class="text-center p-4">
    <div id="footerEN">
      <p>ğŸ“˜ Facebook: <a href="https://www.facebook.com/profile.php?id=61576745039709" target="_blank">Volunteer for My Community</a></p>
      <p>ğŸ’¬ Telegram: <a href="https://t.me/+exCdScgzKltlN2Zl" target="_blank">Join VMCTK</a></p>
      <p>â˜ï¸ Contact: +855 96 998 6500</p>
    </div>
    <div id="footerKH" class="hidden">
      <p>ğŸ“˜ á áŸ’áœáŸáŸá”áŸŠá»á€áŸ– <a href="https://www.facebook.com/profile.php?id=61576745039709" target="_blank">áŸáŸ’á˜áŸá‚áŸ’ášá…á·ááŸ’ááŸá˜áŸ’ášá¶á”áŸ‹áŸá á‚á˜á“áŸ</a></p>
      <p>ğŸ’¬ ááŸá›áŸá€áŸ’ášá¶á˜áŸ– <a href="https://t.me/+exCdScgzKltlN2Zl" target="_blank">á…á¼á›ášá½á˜ VMCTK</a></p>
      <p>â˜ï¸ á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„áŸ– +855 96 998 6500</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    // === Basic setup ===
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS75RiAFZNe61Mrh8jhMpnYX-o0XaJynvA2Ho2kfDBzrkeA1ewCftd90oZ2WDIAmeTvHX5c1uKoxIGU/pub?output=csv";
    const body = document.body;
    const themeToggle = document.getElementById("themeToggle");
    const loadingScreen = document.getElementById("loadingScreen");

    // Default Light mode
    body.classList.remove("dark");

    // Toggle Theme
    themeToggle.addEventListener("click", () => {
      body.classList.toggle("dark");
      themeToggle.textContent = body.classList.contains("dark") ? "â˜€ï¸" : "ğŸŒ™";
    });

    // Language buttons
    const enBtn = document.getElementById("enBtn");
    const khBtn = document.getElementById("khBtn");
    const sections = ["aboutEN","aboutKH","contactEN","contactKH","footerEN","footerKH"];

    function setLang(lang) {
      sections.forEach(id=>{
        document.getElementById(id).classList.toggle("hidden", !id.endsWith(lang.toUpperCase()));
      });
      document.getElementById("subtitle").textContent =
        lang==="en" ? "Volunteer for My Community" : "áŸáŸ’á˜áŸá‚áŸ’ášá…á·ááŸ’ááŸá˜áŸ’ášá¶á”áŸ‹áŸá á‚á˜á“áŸášá”áŸáŸ‹ááŸ’á‰á»áŸ†";
    }

    enBtn.onclick=()=>setLang("en");
    khBtn.onclick=()=>setLang("kh");

    // Loading animation + quote fade
    window.addEventListener("load",()=>{
      setTimeout(()=>loadingScreen.classList.add("fade-out"),1500);
    });

    // Random quotes
    const quoteText=document.getElementById("quoteText");
    const quotes=[
      "ğŸ“– A reader lives a thousand lives before he dies.",
      "ğŸŒ± Knowledge shared is knowledge multiplied.",
      "ğŸš€ The future belongs to those who learn today.",
      "ğŸ’¡ Small steps every day create big change.",
      "ğŸ¤ Sharing a book is sharing a world.",
      "ğŸ“š á¢áŸ’á“á€á¢á¶á“áŸáŸ€áœá—áŸ…á‚áºá‡á¶á¢áŸ’á“á€áŠá¹á€á“á¶áŸ†á“á¶á–áŸá›á¢á“á¶á‚ááŸ”",
      "ğŸŒ á€á¶ášá¢á¶á“áŸáŸ€áœá—áŸ…á‡á¶á‚á“áŸ’á›á„á‘áŸ…ášá€á–á“áŸ’á›áºá“áŸƒá…áŸ†ááŸáŸ‡áŠá¹á„áŸ”",
      "ğŸŒˆ Education is the most powerful weapon to change the world.",
      "â¤ï¸ Learn not for school, but for life.",
      "ğŸ“ Reading is dreaming with open eyes."
    ];
    quoteText.textContent=quotes[Math.floor(Math.random()*quotes.length)];

    // === Book Loading ===
    const bookList=document.getElementById("bookList");
    const featuredList=document.getElementById("featuredList");
    const modal=document.getElementById("bookModal");
    const modalCover=document.getElementById("modalCover");
    const modalTitle=document.getElementById("modalTitle");
    const modalAuthor=document.getElementById("modalAuthor");
    const modalLang=document.getElementById("modalLang");
    const modalDesc=document.getElementById("modalDesc");
    const modalRead=document.getElementById("modalRead");
    const modalDownload=document.getElementById("modalDownload");

    function hdCover(url){
      const m=url?.match(/[-\w]{25,}/);
      return m?`https://drive.google.com/thumbnail?id=${m[0]}&sz=w2000`:url;
    }

    async function loadBooks(){
      const resp=await fetch(CSV_URL);
      const text=await resp.text();
      const data=Papa.parse(text,{header:true}).data.filter(b=>b.Title);
      bookList.innerHTML="";
      featuredList.innerHTML="";
      data.forEach((b,i)=>{
        const c=document.createElement("div");
        c.className="rounded-lg shadow hover:scale-105 transition p-4 bg-white dark:bg-gray-800 cursor-pointer";
        c.innerHTML=`<img src="${hdCover(b['Cover Link'])}" class="mb-2 rounded-md"><h3 class="font-bold">${b.Title}</h3>
        <p class='text-sm text-gray-500 dark:text-gray-300'>${b.Author}</p><p class='text-sm text-blue-600 dark:text-blue-300'>${b.Language}</p>`;
        c.onclick=()=>{
          modalCover.src=hdCover(b['Cover Link']);
          modalTitle.textContent=b.Title;
          modalAuthor.textContent=b.Author;
          modalLang.textContent=b.Language;
          modalDesc.textContent=b.Description||"";
          modalRead.href=b["Read Link"];
          modalDownload.href=b["Download Link"];
          modal.classList.add("show");
        };
        bookList.appendChild(c);
        if(i<6){
          const f=c.cloneNode(true);
          f.className="featured-card";
          featuredList.appendChild(f);
        }
      });
    }
    loadBooks();

    document.getElementById("closeModal").onclick=()=>modal.classList.remove("show");
    modal.onclick=e=>{if(e.target===modal)modal.classList.remove("show");};

    // Featured scroll
    document.getElementById("scrollLeft").onclick=()=>featuredList.scrollBy({left:-300,behavior:"smooth"});
    document.getElementById("scrollRight").onclick=()=>featuredList.scrollBy({left:300,behavior:"smooth"});
  </script>
</body>
</html>
