<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VMCTK Digital Library</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --vmc-blue: #1e40af;
      --vmc-light-blue: #3b82f6;
      --vmc-yellow: #facc15;
      --vmc-bg-light: #f3f4f6;
      --vmc-bg-dark: #111827;
      --vmc-text-light: #1f2937;
      --vmc-text-dark: #f9fafb;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--vmc-bg-light);
      color: var(--vmc-text-light);
      transition: background-color 0.6s ease, color 0.6s ease;
    }

    body.dark {
      background-color: var(--vmc-bg-dark);
      color: var(--vmc-text-dark);
    }

    /* ---------- Global helpers for dark mode ---------- */
    body.dark h3 { color: #f9fafb !important; }
    body.dark p  { color: #d1d5db !important; }
    body.dark a  { color: #93c5fd; }
    body.dark .text-blue-500 { color: #60a5fa !important; }

    /* üåô About + Contact contrasts */
    body.dark #aboutVMCTK h2,
    body.dark #contactSection h2 {
      color: var(--vmc-yellow) !important;
    }
    body.dark #aboutVMCTK p,
    body.dark #contactSection p {
      color: #f9fafb !important;
    }
    body.dark #aboutVMCTK strong,
    body.dark #aboutVMCTK em,
    body.dark #aboutVMCTK span {
      color: var(--vmc-yellow) !important;
    }

    /* Featured heading in dark */
    body.dark #featuredSection h2 { color: var(--vmc-yellow) !important; }

    /* Footer contrast in dark */
    body.dark footer p,
    body.dark footer a { color: var(--vmc-yellow) !important; }

    /* ---------- Loading Screen ---------- */
    #loadingScreen {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, var(--vmc-light-blue), var(--vmc-blue));
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-size: 1.1rem;
      z-index: 100;
      transition: opacity 0.8s ease-out;
    }
    #loadingScreen.fade-out { opacity: 0; visibility: hidden; }

    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid var(--vmc-yellow);
      border-radius: 50%;
      width: 40px; height: 40px;
      animation: spin 1s linear infinite;
      margin-bottom: 1rem;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ---------- Header ---------- */
    header {
      background: linear-gradient(to right, var(--vmc-light-blue), var(--vmc-blue));
      color: white;
      transition: background-color 0.6s ease;
    }
    body.dark header {
      background: linear-gradient(to right, #1e293b, var(--vmc-bg-dark));
      color: var(--vmc-yellow);
    }
    #themeToggle { font-size: 1.4rem; color: var(--vmc-yellow); }

    /* ---------- Buttons & links ---------- */
    button, a { transition: background-color 0.3s, color 0.3s, transform 0.2s; }
    button:hover, a:hover { transform: scale(1.05); }
    #enBtn { background-color: var(--vmc-blue); color: white; }
    #khBtn { background-color: var(--vmc-yellow); color: black; }
    #enBtn:hover { background-color: var(--vmc-light-blue); }
    #khBtn:hover { background-color: #fbbf24; }

    /* ---------- Featured Carousel ---------- */
    #featuredSection { background: linear-gradient(to right, #e0f2fe, #fef9c3); }
    body.dark #featuredSection { background: linear-gradient(to right, #1e293b, #1f2937); }
    #featuredList {
      display: flex; gap: 1rem; overflow-x: auto;
      scroll-snap-type: x mandatory; scroll-behavior: smooth;
      padding: 0.5rem; -webkit-overflow-scrolling: touch;
    }
    #featuredList::-webkit-scrollbar { height: 6px; }
    #featuredList::-webkit-scrollbar-thumb { background: var(--vmc-yellow); border-radius: 10px; }
    .featured-card {
      flex: 0 0 85%; max-width: 300px; scroll-snap-align: center;
      border: 2px solid var(--vmc-yellow);
      background-color: rgba(250, 204, 21, 0.1);
      border-radius: 1rem; padding: 0.75rem;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .featured-card:hover { transform: scale(1.03); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
    @media (min-width: 640px) { .featured-card { flex: 0 0 40%; } }
    @media (min-width: 1024px) { .featured-card { flex: 0 0 25%; } }
    .book-cover { width: 100%; height: auto; object-fit: cover; border-radius: 0.75rem; }

    /* ---------- Modal / Glass ---------- */
    .modal {
      display: none; position: fixed; inset: 0;
      background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(8px);
      justify-content: center; align-items: center; z-index: 50;
    }
    .modal.show { display: flex; animation: fadeIn 0.4s ease forwards; }
    @keyframes fadeIn { from {opacity:0; transform:scale(0.95);} to {opacity:1; transform:scale(1);} }
    .modal-content {
      background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(10px);
      border-radius: 1rem; padding: 1.5rem; max-width: 26rem; width: 90%; text-align: center;
      border: 2px solid var(--vmc-blue); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }
    body.dark .modal-content { background: rgba(55, 65, 81, 0.85); }

    /* ---------- Dropdown ---------- */
    #categoryDropdown {
      border: 2px solid var(--vmc-blue); background-color: white;
      color: var(--vmc-text-light); font-weight: 500; transition: all 0.3s;
    }
    body.dark #categoryDropdown {
      background-color: var(--vmc-bg-dark);
      color: var(--vmc-text-dark); border-color: var(--vmc-yellow);
    }
    #categoryDropdown:hover { transform: scale(1.03); border-color: var(--vmc-light-blue); }

    /* ---------- Footer ---------- */
    footer {
      background: linear-gradient(to right, var(--vmc-blue), var(--vmc-light-blue));
      color: white; transition: background-color 0.5s ease;
    }
    body.dark footer {
      background: linear-gradient(to right, var(--vmc-bg-dark), var(--vmc-bg-dark));
      color: var(--vmc-yellow);
    }
    footer a { color: inherit; text-decoration: none; transition: color 0.3s; }
    footer a:hover { color: var(--vmc-yellow); }

    /* ---------- FINAL OVERRIDES: black titles & authors on cards in dark mode ---------- */
    /* (Placed last to ensure precedence) */
    body.dark #bookList h3,
    body.dark #featuredList h3 {
      color: #111827 !important;      /* black titles */
      text-shadow: none !important;   /* remove white glow */
    }
    body.dark #bookList p:not(.text-blue-500),
    body.dark #featuredList p:not(.text-blue-500) {
      color: #111827 !important;      /* black author/extra text */
    }
    body.dark #bookList .text-blue-500,
    body.dark #featuredList .text-blue-500 {
      color: #60a5fa !important;      /* keep language blue */
    }
  </style>
</head>

<body>
  <!-- Loading -->
  <div id="loadingScreen">
    <div class="spinner"></div>
    <p>üìö Loading VMCTK Digital Library...</p>
    <p id="quoteText" class="mt-3 text-sm italic opacity-90"></p>
  </div>

  <!-- Header -->
  <header class="shadow p-4 flex flex-col items-center relative">
    <button id="themeToggle" class="absolute top-4 right-4">üåô</button>
    <img id="logoImage" src="LOGO VMC.png" class="w-24 mb-2" alt="VMCTK Logo">
    <h1 class="text-2xl font-bold text-center">VMCTK Digital Library</h1>
    <p id="subtitle" class="text-gray-200 dark:text-gray-300 text-center">Volunteer for My Community</p>
    <div class="mt-2">
      <button id="enBtn" class="px-3 py-1">English</button>
      <button id="khBtn" class="px-3 py-1 ml-2">·ûÅ·üí·ûò·üÇ·ûö</button>
    </div>
  </header>

  <!-- Search -->
  <section class="p-4 flex justify-center">
    <input id="searchInput" type="text" placeholder="Search books..." class="w-full max-w-xl p-2 border rounded shadow" aria-label="Search books">
  </section>

  <!-- Category Dropdown -->
  <section id="categorySection" class="p-4 flex justify-center">
    <select id="categoryDropdown" class="p-2 border rounded shadow text-gray-700 dark:text-gray-200 dark:bg-gray-800" aria-label="Filter by category">
      <option value="All">All Categories</option>
    </select>
  </section>

  <!-- Featured -->
  <section id="featuredSection" class="p-4">
    <div class="flex justify-between items-center mb-3">
      <h2 class="text-xl sm:text-2xl font-bold text-yellow-500 tracking-wide">‚≠ê Featured Books</h2>
      <div>
        <button id="scrollLeft" class="text-yellow-400 text-2xl hover:text-yellow-300" aria-label="Scroll featured left">‚óÄ</button>
        <button id="scrollRight" class="text-yellow-400 text-2xl hover:text-yellow-300 ml-2" aria-label="Scroll featured right">‚ñ∂</button>
      </div>
    </div>
    <div id="featuredList"></div>
  </section>

  <!-- Book List -->
  <section id="bookList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 p-4"></section>

  <!-- Modal -->
  <div id="bookModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-content relative">
      <button id="closeModal" class="absolute top-2 right-3 bg-red-500 text-white rounded px-2" aria-label="Close">‚úï</button>
      <img id="modalCover" src="" alt="Book Cover" class="mx-auto rounded-lg shadow">
      <h2 id="modalTitle" class="font-bold text-lg mt-2"></h2>
      <p id="modalAuthor" class="text-gray-600 mb-1"></p>
      <p id="modalLang" class="text-yellow-500 mb-3"></p>
      <p id="modalDesc" class="text-gray-700 mb-4"></p>
      <div class="flex justify-between">
        <a id="modalRead" href="#" target="_blank" rel="noopener noreferrer" class="text-green-600 font-semibold">Read Online</a>
        <a id="modalDownload" href="#" download rel="noopener" class="text-blue-600 font-semibold">Download</a>
      </div>
    </div>
  </div>

  <!-- About -->
  <section id="aboutVMCTK" class="px-6 py-10 bg-gradient-to-r from-blue-100 to-indigo-100 dark:from-gray-800 dark:to-gray-900 text-center">
    <img src="LOGO VMC.png" class="w-20 mx-auto mb-4 dark:hidden" alt="VMCTK Logo Light">
    <img src="LOGO_VMC_white.png" class="w-20 mx-auto mb-4 hidden dark:block" alt="VMCTK Logo Dark">
    <div id="aboutEN">
      <h2 class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-3">About VMCTK</h2>
      <p class="max-w-2xl mx-auto text-gray-700 dark:text-gray-300 text-lg leading-relaxed">
        <strong>VMCTK Digital Library</strong> is a volunteer project by <em>Volunteer for My Community</em>,
        helping youths access <span class="text-blue-500 dark:text-blue-300 font-medium">free books</span> in
        <span class="font-semibold">English</span> & <span class="font-semibold">Khmer</span>.
      </p>
    </div>
    <div id="aboutKH" class="hidden">
      <h2 class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-3">·û¢·üÜ·ûñ·û∏ VMCTK</h2>
      <p class="max-w-2xl mx-auto text-gray-700 dark:text-gray-300 text-lg leading-relaxed">
        <strong>·ûî·ûé·üí·ûé·û∂·ûõ·üê·ûô·ûå·û∏·ûá·û∏·ûê·ûõ VMCTK</strong> ·ûÇ·û∫·ûá·û∂·ûÇ·ûò·üí·ûö·üÑ·ûÑ·ûü·üí·ûò·üê·ûÇ·üí·ûö·ûÖ·û∑·ûè·üí·ûè
        <em>Volunteer for My Community</em> ·ûä·ûæ·ûò·üí·ûî·û∏·ûá·ûΩ·ûô
        <span class="text-blue-500 dark:text-blue-300 font-medium">·ûô·ûª·ûú·ûá·ûì·û¢·û∂·ûì·ûü·üÄ·ûú·ûó·üÖ·û•·ûè·ûÇ·û∑·ûè·ûê·üí·ûõ·üÉ</span>·üî
      </p>
    </div>
  </section>

  <!-- Contact -->
  <section id="contactSection" class="px-6 py-10 bg-gradient-to-r from-indigo-100 to-blue-100 dark:from-gray-900 dark:to-gray-800 text-center">
    <div id="contactEN">
      <h2 class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-3">üì¨ Contact Us</h2>
      <p class="text-gray-700 dark:text-gray-300 mb-6">
        Have a question, suggestion, or want to volunteer? We‚Äôd love to hear from you!
      </p>
    </div>
    <div id="contactKH" class="hidden">
      <h2 class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-3">üì¨ ·ûë·üÜ·ûì·û∂·ûÄ·üã·ûë·üÜ·ûì·ûÑ·ûò·ûÄ·ûô·ûæ·ûÑ</h2>
      <p class="text-gray-700 dark:text-gray-300 mb-6">
        ·ûò·û∂·ûì·ûü·üÜ·ûé·ûΩ·ûö ·û¨·ûÖ·ûÑ·üã·ûÖ·ûº·ûõ·ûö·ûΩ·ûò·ûá·ûΩ·ûô·ûü·üí·ûò·üê·ûÇ·üí·ûö·ûÖ·û∑·ûè·üí·ûè·ûò·üÇ·ûì·ûë·üÅ? ·ûô·ûæ·ûÑ·ûö·û∏·ûÄ·ûö·û∂·ûô·ûü·üí·ûè·û∂·ûî·üã·ûñ·û∏·û¢·üí·ûì·ûÄ·üî
      </p>
    </div>
    <iframe
      src="https://docs.google.com/forms/d/e/1FAIpQLSe4MTbFG2ZmE-9JYGccFdh3yWlW-x7Fbck1DXAIafONQk_vUA/viewform?embedded=true"
      width="100%"
      height="600"
      frameborder="0"
      class="rounded-lg shadow-lg max-w-3xl mx-auto"></iframe>
  </section>

  <!-- Footer -->
  <footer class="text-center p-4">
    <div id="footerEN">
      <p>üìò Facebook: <a href="https://www.facebook.com/profile.php?id=61576745039709" target="_blank" rel="noopener noreferrer">Volunteer for My Community</a></p>
      <p>üí¨ Telegram: <a href="https://t.me/+exCdScgzKltlN2Zl" target="_blank" rel="noopener noreferrer">Join VMCTK</a></p>
      <p>‚òéÔ∏è Contact: +855 96 998 6500</p>
    </div>
    <div id="footerKH" class="hidden">
      <p>üìò ·û†·üí·ûú·üÅ·ûü·ûî·üä·ûª·ûÄ·üñ <a href="https://www.facebook.com/profile.php?id=61576745039709" target="_blank" rel="noopener noreferrer">·ûü·üí·ûò·üê·ûÇ·üí·ûö·ûÖ·û∑·ûè·üí·ûè·ûü·ûò·üí·ûö·û∂·ûî·üã·ûü·û†·ûÇ·ûò·ûì·üç</a></p>
      <p>üí¨ ·ûè·üÅ·ûõ·üÅ·ûÄ·üí·ûö·û∂·ûò·üñ <a href="https://t.me/+exCdScgzKltlN2Zl" target="_blank" rel="noopener noreferrer">·ûÖ·ûº·ûõ·ûö·ûΩ·ûò VMCTK</a></p>
      <p>‚òéÔ∏è ·ûë·üÜ·ûì·û∂·ûÄ·üã·ûë·üÜ·ûì·ûÑ·üñ +855 96 998 6500</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    // Core config
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS75RiAFZNe61Mrh8jhMpnYX-o0XaJynvA2Ho2kfDBzrkeA1ewCftd90oZ2WDIAmeTvHX5c1uKoxIGU/pub?output=csv";
    const loadingScreen = document.getElementById("loadingScreen");
    const quoteText = document.getElementById("quoteText");
    const bookListEl = document.getElementById("bookList");

    const quotes = [
      "üìñ A reader lives a thousand lives before he dies.",
      "üå± Knowledge shared is knowledge multiplied.",
      "üöÄ The future belongs to those who learn today.",
      "üí° Small steps every day create big change.",
      "ü§ù Sharing a book is sharing a world.",
      "üìö ·û¢·üí·ûì·ûÄ·û¢·û∂·ûì·ûü·üÄ·ûú·ûó·üÖ·ûÇ·û∫·ûá·û∂·û¢·üí·ûì·ûÄ·ûä·ûπ·ûÄ·ûì·û∂·üÜ·ûì·û∂·ûñ·üÅ·ûõ·û¢·ûì·û∂·ûÇ·ûè·üî",
      "üåû ·ûÄ·û∂·ûö·û¢·û∂·ûì·ûü·üÄ·ûú·ûó·üÖ·ûá·û∂·ûÇ·ûì·üí·ûõ·ûÑ·ûë·üÖ·ûö·ûÄ·ûñ·ûì·üí·ûõ·û∫·ûì·üÉ·ûÖ·üÜ·ûé·üÅ·üá·ûä·ûπ·ûÑ·üî",
      "üåà Education is the most powerful weapon to change the world.",
      "‚ù§Ô∏è Learn not for school, but for life.",
      "üéì Reading is dreaming with open eyes."
    ];

    function showRandomQuote() {
      let current = quotes[Math.floor(Math.random() * quotes.length)];
      quoteText.textContent = current;
      setTimeout(() => {
        quoteText.style.opacity = "0";
        setTimeout(() => {
          let nextQ;
          do {
            nextQ = quotes[Math.floor(Math.random() * quotes.length)];
          } while (nextQ === current);
          quoteText.textContent = nextQ;
          quoteText.style.opacity = "1";
        }, 1000);
      }, 4000);
    }
    showRandomQuote();

    let books = [];

    function getHdCover(url) {
      if (!url) return "";
      const match = url.match(/[-\w]{25,}/);
      return match ? `https://drive.google.com/thumbnail?id=${match[0]}&sz=w2000` : url;
    }
    function getThumbCover(url) {
      if (!url) return "";
      const match = url.match(/[-\w]{25,}/);
      return match ? `https://drive.google.com/thumbnail?id=${match[0]}&sz=w600` : url;
    }

    async function loadBooks() {
      const resp = await fetch(CSV_URL);
      const text = await resp.text();
      const parsed = Papa.parse(text, { header: true });
      books = parsed.data.filter(b => b.Title);

      const featuredList = document.getElementById("featuredList");
      const categoryDropdown = document.getElementById("categoryDropdown");

      // reset
      bookListEl.innerHTML = "";
      featuredList.innerHTML = "";

      // categories
      const categories = [...new Set(books.map(b => b.Category?.trim()).filter(Boolean))];
      categoryDropdown.innerHTML = `<option value="All">All Categories</option>` +
        categories.map(cat => `<option value="${cat}">${cat}</option>`).join("");

      categoryDropdown.addEventListener("change", e => {
        showBooks(e.target.value);
      });

      // featured
      books.forEach((b, originalIdx) => {
        if (b.Featured && b.Featured.toLowerCase() === "yes" && featuredList.childElementCount < 5) {
          const f = document.createElement("div");
          f.className = "featured-card";
          f.innerHTML = `
            <img src="${getThumbCover(b["Cover Link"])}" loading="lazy" decoding="async" alt="Cover of ${b.Title}" class="book-cover mb-2">
            <h3 class="font-semibold">${b.Title}</h3>`;
          f.onclick = () => openModal(originalIdx);
          featuredList.appendChild(f);
        }
      });

      // initial
      showBooks("All");
      loadingScreen.classList.add("fade-out");
    }

    function showBooks(category) {
      bookListEl.innerHTML = "";

      const filtered = books.filter(b => category === "All" || b.Category?.trim() === category);

      filtered.forEach((b) => {
        // robust way to find the original index
        const idxForModal = books.findIndex(x =>
          x["PDF Link"] === b["PDF Link"] && x.Title === b.Title
        );

        const card = document.createElement("div");
        card.className = "rounded-lg shadow hover:scale-105 transition p-4 bg-white dark:bg-gray-800 cursor-pointer";
        card.innerHTML = `
          <img src="${getThumbCover(b["Cover Link"])}" loading="lazy" decoding="async" alt="Cover of ${b.Title}" class="book-cover mb-2">
          <h3 class="font-bold">${b.Title}</h3>
          <p class="text-sm text-gray-500 dark:text-gray-300">${b.Author}</p>
          <p class="text-sm text-blue-500"> ${b.Language}</p>
        `;
        card.onclick = () => openModal(idxForModal >= 0 ? idxForModal : 0);
        bookListEl.appendChild(card);
      });

      if (filtered.length === 0) {
        bookListEl.innerHTML = `<p class="text-center text-gray-500 dark:text-gray-300 col-span-full">No books found in this category.</p>`;
      }
    }

    // Modal
    const modal = document.getElementById("bookModal");
    const closeBtn = document.getElementById("closeModal");
    closeBtn.onclick = () => modal.classList.remove("show");
    window.onclick = e => { if (e.target === modal) modal.classList.remove("show"); };
    // ESC to close
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") modal.classList.remove("show");
    });

    function openModal(idx) {
      const b = books[idx];
      document.getElementById("modalCover").src = getHdCover(b["Cover Link"]);
      document.getElementById("modalTitle").textContent = b.Title;
      document.getElementById("modalAuthor").textContent = b.Author;
      document.getElementById("modalLang").textContent = b.Language;
      document.getElementById("modalDesc").textContent = b.Description;
      document.getElementById("modalRead").href = b["PDF Link"];
      document.getElementById("modalDownload").href = b["PDF Link"];
      modal.classList.add("show");
    }

    // Language toggle
    document.getElementById("enBtn").onclick = () => {
      ["aboutEN","contactEN","footerEN"].forEach(id => document.getElementById(id).classList.remove("hidden"));
      ["aboutKH","contactKH","footerKH"].forEach(id => document.getElementById(id).classList.add("hidden"));
    };
    document.getElementById("khBtn").onclick = () => {
      ["aboutKH","contactKH","footerKH"].forEach(id => document.getElementById(id).classList.remove("hidden"));
      ["aboutEN","contactEN","footerEN"].forEach(id => document.getElementById(id).classList.add("hidden"));
    };

    // Theme toggle
    const themeToggle = document.getElementById("themeToggle");
    const logoImage = document.getElementById("logoImage");
    themeToggle.onclick = () => {
      document.body.classList.toggle("dark");
      const isDark = document.body.classList.contains("dark");
      themeToggle.textContent = isDark ? "‚òÄÔ∏è" : "üåô";
      logoImage.src = isDark ? "LOGO_VMC_white.png" : "LOGO VMC.png";
      localStorage.setItem("theme", isDark ? "dark" : "light");
    };
    if (localStorage.getItem("theme") === "dark") {
      document.body.classList.add("dark");
      themeToggle.textContent = "‚òÄÔ∏è";
      logoImage.src = "LOGO_VMC_white.png";
    }

    // Featured scroll arrows
    document.getElementById("scrollLeft").onclick = () => {
      document.getElementById("featuredList").scrollBy({ left: -250, behavior: "smooth" });
    };
    document.getElementById("scrollRight").onclick = () => {
      document.getElementById("featuredList").scrollBy({ left: 250, behavior: "smooth" });
    };

    // Auto-scroll featured
    let autoScrollActive = true;
    const fList = document.getElementById("featuredList");
    function autoScroll() {
      if (!autoScrollActive) return;
      fList.scrollBy({ left: 1, behavior: "smooth" });
      if (fList.scrollLeft + fList.clientWidth >= fList.scrollWidth - 1) {
        fList.scrollTo({ left: 0, behavior: "smooth" });
      }
    }
    setInterval(autoScroll, 40);
    ["mouseenter", "touchstart"].forEach(ev => fList.addEventListener(ev, () => autoScrollActive = false));
    ["mouseleave", "touchend"].forEach(ev => fList.addEventListener(ev, () => autoScrollActive = true));

    // Search filter + "no results" message
    const searchEl = document.getElementById("searchInput");
    searchEl.addEventListener("input", e => {
      const term = e.target.value.toLowerCase();
      const cards = Array.from(document.querySelectorAll("#bookList > div"));
      let visible = 0;
      cards.forEach(card => {
        const title = card.querySelector("h3").textContent.toLowerCase();
        const author = card.querySelector("p").textContent.toLowerCase();
        const match = title.includes(term) || author.includes(term);
        card.style.display = match ? "block" : "none";
        if (match) visible++;
      });
      const emptyId = "noSearchResults";
      let empty = document.getElementById(emptyId);
      if (!visible) {
        if (!empty) {
          empty = document.createElement("p");
          empty.id = emptyId;
          empty.className = "text-center text-gray-500 dark:text-gray-300 col-span-full";
          bookListEl.appendChild(empty);
        }
        empty.textContent = `No books match ‚Äú${term}‚Äù.`;
      } else if (empty) {
        empty.remove();
      }
    });

    window.onload = loadBooks;
  </script>
</body>
</html>
