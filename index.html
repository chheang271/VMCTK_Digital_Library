<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VMCTK Digital Library</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      transition: background-color 0.5s, color 0.5s;
    }
    .dark-mode {
      background-color: #1e293b;
      color: #f1f5f9;
    }
    .glass {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 transition-all duration-500">

  <!-- Header -->
  <div class="text-center py-6">
    <img src="https://raw.githubusercontent.com/chheang271/VMCTK_Digital_Library/main/assets/LOGO%20VMC.png" alt="VMCTK Logo" class="mx-auto w-28 mb-2">
    <h1 class="text-2xl font-bold">VMCTK Digital Library</h1>
    <p class="text-sm">Volunteer for My Community</p>
    <div class="mt-3">
      <button id="enBtn" class="bg-blue-500 text-white px-3 py-1 rounded">English</button>
      <button id="khBtn" class="bg-gray-300 text-gray-800 px-3 py-1 rounded">ខ្មែរ</button>
    </div>
    <button id="themeToggle" class="absolute right-4 top-4 text-2xl">🌙</button>
  </div>

  <!-- Search -->
  <div class="flex justify-center mb-6">
    <input id="searchInput" type="text" placeholder="Search books..." class="w-3/4 max-w-md px-4 py-2 rounded-lg border border-gray-300 focus:ring focus:ring-blue-200" />
  </div>

  <!-- Books Grid -->
  <div id="bookContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 px-6 mb-12"></div>

  <!-- Modal -->
  <div id="bookModal" class="fixed inset-0 hidden justify-center items-center bg-black bg-opacity-50 backdrop-blur-sm z-50">
    <div class="glass rounded-2xl p-6 w-80 sm:w-96 shadow-xl text-center relative">
      <button id="closeModal" class="absolute top-2 right-3 text-gray-300 hover:text-white text-xl">✕</button>
      <img id="modalCover" src="" alt="Cover" class="w-full h-80 object-cover rounded-lg mb-4">
      <h2 id="modalTitle" class="text-lg font-bold mb-1"></h2>
      <p id="modalAuthor" class="text-sm mb-1"></p>
      <p id="modalLanguage" class="text-xs text-blue-400 mb-2"></p>
      <p id="modalDescription" class="text-sm mb-4"></p>
      <div class="flex justify-center gap-3">
        <a id="readBtn" href="#" target="_blank" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded">Read Online</a>
        <a id="downloadBtn" href="#" target="_blank" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded">Download</a>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-gray-900 text-gray-300 py-6 text-center">
    <p class="text-sm mb-2">© 2025 VMCTK Digital Library — All books are free for learning</p>
    <div class="flex justify-center gap-6">
      <a href="https://www.facebook.com/profile.php?id=61576745039709" target="_blank" class="hover:text-blue-400">Facebook</a>
      <a href="https://t.me/+exCdScgzKltlN2Zl" target="_blank" class="hover:text-blue-400">Telegram</a>
      <a href="tel:+855969986500" class="hover:text-blue-400">+855 96 998 6500</a>
    </div>
    <div class="mt-3">
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSe4MTbFG2ZmE-9JYGccFdh3yWlW-x7Fbck1DXAIafONQk_vUA/viewform?usp=header"
         target="_blank"
         class="text-yellow-400 hover:text-yellow-500 underline">Contact Us</a>
    </div>
  </footer>

  <script>
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS75RiAFZNe61Mrh8jhMpnYX-o0XaJynvA2Ho2kfDBzrkeA1ewCftd90oZ2WDIAmeTvHX5c1uKoxIGU/pub?output=csv";

    const bookContainer = document.getElementById("bookContainer");
    const searchInput = document.getElementById("searchInput");
    const modal = document.getElementById("bookModal");
    const closeModal = document.getElementById("closeModal");

    // Modal elements
    const modalCover = document.getElementById("modalCover");
    const modalTitle = document.getElementById("modalTitle");
    const modalAuthor = document.getElementById("modalAuthor");
    const modalLanguage = document.getElementById("modalLanguage");
    const modalDescription = document.getElementById("modalDescription");
    const readBtn = document.getElementById("readBtn");
    const downloadBtn = document.getElementById("downloadBtn");

    // Fetch CSV
    fetch(sheetUrl)
      .then(res => res.text())
      .then(csv => {
        const rows = csv.split("\n").map(r => r.split(","));
        const headers = rows.shift().map(h => h.trim());
        const books = rows.map(row => {
          let obj = {};
          headers.forEach((h, i) => obj[h] = row[i]);
          return obj;
        });

        displayBooks(books);

        searchInput.addEventListener("input", e => {
          const filtered = books.filter(b =>
            b["Title"]?.toLowerCase().includes(e.target.value.toLowerCase())
          );
          displayBooks(filtered);
        });
      });

    function displayBooks(books) {
      bookContainer.innerHTML = "";
      books.forEach(b => {
        const card = document.createElement("div");
        card.className = "bg-white dark:bg-gray-800 rounded-xl shadow hover:shadow-lg transition overflow-hidden cursor-pointer";
        card.innerHTML = `
          <img src="${b["Cover Link"]}" class="w-full h-72 object-cover" alt="Book Cover">
          <div class="p-4">
            <h3 class="font-bold text-gray-800 dark:text-white">${b["Title"]}</h3>
            <p class="text-sm text-gray-600 dark:text-gray-300">${b["Author"]}</p>
            <p class="text-xs text-blue-500">${b["Language"]}</p>
          </div>
        `;
        card.onclick = () => openModal(b);
        bookContainer.appendChild(card);
      });
    }

    function openModal(b) {
      modalCover.src = b["Cover Link"];
      modalTitle.textContent = b["Title"];
      modalAuthor.textContent = b["Author"];
      modalLanguage.textContent = b["Language"];
      modalDescription.textContent = b["Description"];

      const readLink = b["PDF Link"] && b["PDF Link"].startsWith("http") ? b["PDF Link"] : null;
      const downloadLink = b["PDF Link"] && b["PDF Link"].startsWith("http") ? b["PDF Link"] : null;

      readBtn.href = readLink || "#";
      downloadBtn.href = downloadLink || "#";

      readBtn.classList.toggle("opacity-50", !readLink);
      downloadBtn.classList.toggle("opacity-50", !downloadLink);

      modal.classList.remove("hidden");
      modal.classList.add("flex");
    }

    closeModal.onclick = () => modal.classList.add("hidden");

    // Theme Toggle
    const themeToggle = document.getElementById("themeToggle");
    themeToggle.onclick = () => {
      document.body.classList.toggle("dark-mode");
      themeToggle.textContent = document.body.classList.contains("dark-mode") ? "☀️" : "🌙";
    };
  </script>
</body>
</html>
