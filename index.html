<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VMCTK Digital Library</title>
  <link rel="icon" href="LOGO VMC.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      transition: background-color 0.3s, color 0.3s;
    }
    .dark {
      background-color: #111827;
      color: #f9fafb;
    }
    .fade-out {
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.6s ease, visibility 0.6s ease;
    }
    #loadingScreen {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #2563eb, #9333ea);
      color: white;
      font-size: 1.5rem;
      font-weight: bold;
      z-index: 50;
    }
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin-top: 16px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(8px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 50;
    }
    .modal.show {
      display: flex;
    }
    .modal-content {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 16px;
      padding: 24px;
      max-width: 420px;
      text-align: center;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }
    .dark .modal-content {
      background: rgba(31, 41, 55, 0.9);
      color: #f9fafb;
    }
    .modal img {
      max-width: 100%;
      border-radius: 10px;
      margin-bottom: 16px;
    }
    .tooltip {
      position: relative;
      display: inline-block;
    }
    .tooltip .tooltip-text {
      visibility: hidden;
      width: 110px;
      background-color: rgba(0, 0, 0, 0.8);
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 4px 6px;
      position: absolute;
      z-index: 10;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }
    body.dark h3 {
      color: #f9fafb;
      text-shadow: 0 0 6px rgba(255, 255, 255, 0.5);
    }
  </style>
</head>

<body class="bg-gray-100 text-gray-800">
  <!-- Loading Screen -->
  <div id="loadingScreen">
    <div>ğŸ“š VMCTK Digital Library</div>
    <div class="spinner"></div>
    <div id="quoteText" class="mt-4 text-lg italic opacity-90"></div>
  </div>

  <!-- Header -->
  <header class="flex flex-col items-center p-4">
    <img src="LOGO VMC.png" alt="Logo" class="w-20 mb-2">
    <h1 class="text-2xl font-bold">VMCTK Digital Library</h1>
    <p id="subtitle" class="text-gray-500">Volunteer for My Community</p>
    <div class="flex space-x-2 mt-3">
      <button id="enBtn" class="bg-blue-600 text-white px-3 py-1 rounded">English</button>
      <button id="khBtn" class="bg-gray-300 text-black px-3 py-1 rounded">ááŸ’á˜áŸ‚áš</button>
    </div>
    <button id="themeToggle" class="absolute right-6 top-6 text-xl">ğŸŒ™</button>
  </header>

  <!-- Search Bar -->
  <div class="p-4 flex justify-center">
    <input type="text" id="searchInput" placeholder="Search books..."
      class="w-full max-w-lg border p-2 rounded shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400" />
  </div>

  <!-- Featured Books -->
  <section class="p-6">
    <div class="flex justify-between items-center mb-3">
      <h2 class="text-xl font-bold text-yellow-500">â­ Featured Books</h2>
      <div>
        <button id="scrollLeft" class="px-3 text-lg">â¬…ï¸</button>
        <button id="scrollRight" class="px-3 text-lg">â¡ï¸</button>
      </div>
    </div>
    <div id="featuredList" class="flex overflow-x-auto gap-4 pb-4"></div>
  </section>

  <!-- Book List -->
  <main id="bookList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 p-6"></main>

  <!-- Modal -->
  <div id="bookModal" class="modal">
    <div class="modal-content">
      <button id="closeModal" class="absolute right-4 top-2 text-xl font-bold">âœ–</button>
      <img id="modalCover" src="" alt="Book Cover">
      <h2 id="modalTitle" class="text-xl font-bold mb-2"></h2>
      <p id="modalAuthor" class="text-gray-600 dark:text-gray-300"></p>
      <p id="modalLang" class="text-blue-500 dark:text-blue-300 mb-2"></p>
      <p id="modalDesc" class="text-gray-700 dark:text-gray-300 mb-4"></p>
      <div class="flex justify-center gap-4">
        <div class="tooltip">
          <a id="modalRead" target="_blank"
            class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition">Read Online</a>
          <span class="tooltip-text">Not available</span>
        </div>
        <div class="tooltip">
          <a id="modalDownload" target="_blank"
            class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition">Download</a>
          <span class="tooltip-text">Not available</span>
        </div>
      </div>
    </div>
  </div>

  <!-- About Section -->
  <section id="aboutVMCTK" class="px-6 py-10 bg-gradient-to-r from-blue-100 to-indigo-100 dark:from-gray-800 dark:to-gray-900 text-center">
    <img src="LOGO VMC.png" class="w-20 mx-auto mb-4 dark:hidden">
    <img src="LOGO_VMC_white.png" class="w-20 mx-auto mb-4 hidden dark:block">
    <div id="aboutEN">
      <h2 class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-3">About VMCTK</h2>
      <p class="max-w-2xl mx-auto text-gray-700 dark:text-gray-300 text-lg leading-relaxed">
        <strong>VMCTK Digital Library</strong> is a volunteer project by
        <em>Volunteer for My Community</em>, helping youths access free books in
        <span class="text-blue-500 dark:text-blue-300 font-medium">English</span> and
        <span class="font-semibold">Khmer</span>.
      </p>
    </div>
    <div id="aboutKH" class="hidden">
      <h2 class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-3">á¢áŸ†á–á¸ VMCTK</h2>
      <p class="max-w-2xl mx-auto text-gray-700 dark:text-gray-300 text-lg leading-relaxed">
        <strong>á”ááŸ’áá¶á›áŸá™áŒá¸á‡á¸áá› VMCTK</strong> á‚áºá‡á¶á‚á˜áŸ’ášáŸ„á„áŸáŸ’á˜áŸá‚áŸ’ášá…á·ááŸ’á
        <em>Volunteer for My Community</em> áŠá¾á˜áŸ’á”á¸á‡á½á™
        <span class="text-blue-500 dark:text-blue-300 font-medium">á™á»áœá‡á“á¢á¶á“áŸáŸ€áœá—áŸ…á¥áá‚á·áááŸ’á›áŸƒ</span>áŸ”
      </p>
    </div>
  </section>

  <!-- Contact -->
  <section id="contactSection" class="px-6 py-10 bg-gradient-to-r from-indigo-100 to-blue-100 dark:from-gray-900 dark:to-gray-800 text-center">
    <div id="contactEN">
      <h2 class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-3">ğŸ“¬ Contact Us</h2>
      <p class="text-gray-700 dark:text-gray-300 mb-6">
        Have a question, suggestion, or want to volunteer? Weâ€™d love to hear from you!
      </p>
    </div>
    <div id="contactKH" class="hidden">
      <h2 class="text-2xl font-bold text-blue-600 dark:text-blue-400 mb-3">ğŸ“¬ á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„á˜á€á™á¾á„</h2>
      <p class="text-gray-700 dark:text-gray-300 mb-6">
        á˜á¶á“áŸáŸ†áá½áš á¬á…á„áŸ‹á…á¼á›ášá½á˜á‡á½á™áŸáŸ’á˜áŸá‚áŸ’ášá…á·ááŸ’áá˜áŸ‚á“á‘áŸ? á™á¾á„ášá¸á€ášá¶á™áŸáŸ’áá¶á”áŸ‹á–á¸á¢áŸ’á“á€áŸ”
      </p>
    </div>
    <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSe4MTbFG2ZmE-9JYGccFdh3yWlW-x7Fbck1DXAIafONQk_vUA/viewform?embedded=true"
      width="100%" height="600" frameborder="0"
      class="rounded-lg shadow-lg max-w-3xl mx-auto"></iframe>
  </section>

  <!-- Footer -->
  <footer class="text-center p-4">
    <div id="footerEN">
      <p>ğŸ“˜ Facebook: <a href="https://www.facebook.com/profile.php?id=61576745039709" target="_blank">Volunteer for My Community</a></p>
      <p>ğŸ’¬ Telegram: <a href="https://t.me/+exCdScgzKltlN2Zl" target="_blank">Join VMCTK</a></p>
      <p>â˜ï¸ Contact: +855 96 998 6500</p>
    </div>
    <div id="footerKH" class="hidden">
      <p>ğŸ“˜ á áŸ’áœáŸáŸá”áŸŠá»á€áŸ– <a href="https://www.facebook.com/profile.php?id=61576745039709" target="_blank">áŸáŸ’á˜áŸá‚áŸ’ášá…á·ááŸ’ááŸá˜áŸ’ášá¶á”áŸ‹áŸá á‚á˜á“áŸ</a></p>
      <p>ğŸ’¬ ááŸá›áŸá€áŸ’ášá¶á˜áŸ– <a href="https://t.me/+exCdScgzKltlN2Zl" target="_blank">á…á¼á›ášá½á˜ VMCTK</a></p>
      <p>â˜ï¸ á‘áŸ†á“á¶á€áŸ‹á‘áŸ†á“á„áŸ– +855 96 998 6500</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS75RiAFZNe61Mrh8jhMpnYX-o0XaJynvA2Ho2kfDBzrkeA1ewCftd90oZ2WDIAmeTvHX5c1uKoxIGU/pub?output=csv";
    const body = document.body;
    const themeToggle = document.getElementById("themeToggle");
    const loadingScreen = document.getElementById("loadingScreen");

    // Default Light Mode
    body.classList.remove("dark");

    // Toggle Theme
    themeToggle.addEventListener("click", () => {
      body.classList.toggle("dark");
      themeToggle.textContent = body.classList.contains("dark") ? "â˜€ï¸" : "ğŸŒ™";
    });

    // Language Switch
    const enBtn = document.getElementById("enBtn");
    const khBtn = document.getElementById("khBtn");
    const sections = ["aboutEN", "aboutKH", "contactEN", "contactKH", "footerEN", "footerKH"];

    function setLang(lang) {
      sections.forEach(id => {
        document.getElementById(id).classList.toggle("hidden", !id.endsWith(lang.toUpperCase()));
      });
      document.getElementById("subtitle").textContent =
        lang === "en" ? "Volunteer for My Community" : "áŸáŸ’á˜áŸá‚áŸ’ášá…á·ááŸ’ááŸá˜áŸ’ášá¶á”áŸ‹áŸá á‚á˜á“áŸášá”áŸáŸ‹ááŸ’á‰á»áŸ†";
    }

    enBtn.onclick = () => setLang("en");
    khBtn.onclick = () => setLang("kh");

    // Load animation
    window.addEventListener("load", () => {
      setTimeout(() => loadingScreen.classList.add("fade-out"), 1500);
    });

    // Random Quotes
    const quoteText = document.getElementById("quoteText");
    const quotes = [
      "ğŸ“– A reader lives a thousand lives before he dies.",
      "ğŸŒ± Knowledge shared is knowledge multiplied.",
      "ğŸš€ The future belongs to those who learn today.",
      "ğŸ’¡ Small steps every day create big change.",
      "ğŸ¤ Sharing a book is sharing a world.",
      "ğŸ“š á¢áŸ’á“á€á¢á¶á“áŸáŸ€áœá—áŸ…á‚áºá‡á¶á¢áŸ’á“á€áŠá¹á€á“á¶áŸ†á“á¶á–áŸá›á¢á“á¶á‚ááŸ”",
      "ğŸŒ á€á¶ášá¢á¶á“áŸáŸ€áœá—áŸ…á‡á¶á‚á“áŸ’á›á„á‘áŸ…ášá€á–á“áŸ’á›áºá“áŸƒá…áŸ†ááŸáŸ‡áŠá¹á„áŸ”",
      "ğŸŒˆ Education is the most powerful weapon to change the world.",
      "â¤ï¸ Learn not for school, but for life.",
      "ğŸ“ Reading is dreaming with open eyes."
    ];
    quoteText.textContent = quotes[Math.floor(Math.random() * quotes.length)];

    // === Book Section ===
    const bookList = document.getElementById("bookList");
    const featuredList = document.getElementById("featuredList");
    const modal = document.getElementById("bookModal");
    const modalCover = document.getElementById("modalCover");
    const modalTitle = document.getElementById("modalTitle");
    const modalAuthor = document.getElementById("modalAuthor");
    const modalLang = document.getElementById("modalLang");
    const modalDesc = document.getElementById("modalDesc");
    const modalRead = document.getElementById("modalRead");
    const modalDownload = document.getElementById("modalDownload");

    function hdCover(url) {
      const m = url?.match(/[-\w]{25,}/);
      return m ? `https://drive.google.com/thumbnail?id=${m[0]}&sz=w2000` : url;
    }

    async function loadBooks() {
      const resp = await fetch(CSV_URL);
      const text = await resp.text();
      const data = Papa.parse(text, { header: true }).data.filter(b => b.Title);
      bookList.innerHTML = "";
      featuredList.innerHTML = "";

      data.forEach((b, i) => {
        const c = document.createElement("div");
        c.className = "rounded-lg shadow hover:scale-105 transition p-4 bg-white dark:bg-gray-800 cursor-pointer";
        c.innerHTML = `
          <img src="${hdCover(b['Cover Link'])}" class="mb-2 rounded-md">
          <h3 class="font-bold">${b.Title}</h3>
          <p class='text-sm text-gray-500 dark:text-gray-300'>${b.Author}</p>
          <p class='text-sm text-blue-600 dark:text-blue-300'>${b.Language}</p>
        `;
        c.onclick = () => {
          modalCover.src = hdCover(b['Cover Link']);
          modalTitle.textContent = b.Title || "Untitled Book";
          modalAuthor.textContent = b.Author || "Unknown Author";
          modalLang.textContent = b.Language || "";
          modalDesc.textContent = b.Description || "No description available.";

          const readLink = b["Read Link"] && b["Read Link"].startsWith("http")
            ? b["Read Link"]
            : null;
          const downloadLink = b["Download Link"] && b["Download Link"].startsWith("http")
            ? b["Download Link"]
            : null;

          modalRead.href = readLink || "#";
          modalDownload.href = downloadLink || "#";

          modalRead.style.pointerEvents = readLink ? "auto" : "none";
          modalDownload.style.pointerEvents = downloadLink ? "auto" : "none";
          modalRead.style.opacity = readLink ? "1" : "0.5";
          modalDownload.style.opacity = downloadLink ? "1" : "0.5";

          modal.classList.add("show");
        };
        bookList.appendChild(c);

        if (i < 6) {
          const f = c.cloneNode(true);
          featuredList.appendChild(f);
        }
      });
    }

    loadBooks();

    document.getElementById("closeModal").onclick = () => modal.classList.remove("show");
    modal.onclick = (e) => { if (e.target === modal) modal.classList.remove("show"); };

    // Featured Scroll
    document.getElementById("scrollLeft").onclick = () => featuredList.scrollBy({ left: -300, behavior: "smooth" });
    document.getElementById("scrollRight").onclick = () => featuredList.scrollBy({ left: 300, behavior: "smooth" });
  </script>
</body>
</html>
