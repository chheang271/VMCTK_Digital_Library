<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VMCTK ‚Äì Add New Book</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 text-slate-800">
  <div class="min-h-screen max-w-3xl mx-auto px-4 py-6">
    <header class="mb-6 flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-bold text-slate-900">Add New Book</h1>
        <p class="text-sm text-slate-500">
          This form will append a new row to <strong>Sheet1</strong> in your Google Sheet.
        </p>
      </div>
      <div class="flex gap-3 text-sm">
        <a href="admin.html" class="text-blue-600 hover:underline">üìä Dashboard</a>
        <a href="index.html" class="text-blue-600 hover:underline">‚Üê Back to Library</a>
      </div>
    </header>

    <section class="bg-white rounded-xl shadow p-5">
      <form id="bookForm" class="space-y-4">
        <!-- Admin key -->
        <div>
          <label class="block text-xs font-semibold text-slate-600 mb-1" for="adminKey">
            Admin key <span class="text-red-500">*</span>
          </label>
          <input
            id="adminKey"
            name="adminKey"
            type="password"
            required
            class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-blue-200"
            placeholder="Enter the same ADMIN_KEY as in Apps Script"
          />
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="block text-xs font-semibold text-slate-600 mb-1" for="title">
              Title <span class="text-red-500">*</span>
            </label>
            <input
              id="title"
              name="title"
              type="text"
              required
              class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-blue-200"
              placeholder="Book title"
            />
          </div>

          <div>
            <label class="block text-xs font-semibold text-slate-600 mb-1" for="author">
              Author
            </label>
            <input
              id="author"
              name="author"
              type="text"
              class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-blue-200"
              placeholder="Author name"
            />
          </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="block text-xs font-semibold text-slate-600 mb-1" for="language">
              Language
            </label>
            <select
              id="language"
              name="language"
              class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-blue-200"
            >
              <option value="">‚Äì Select ‚Äì</option>
              <option value="Khmer">Khmer</option>
              <option value="English">English</option>
              <option value="Bilingual">Bilingual</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold text-slate-600 mb-1" for="category">
              Category
            </label>
            <input
              id="category"
              name="category"
              type="text"
              class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-blue-200"
              placeholder="e.g. Novel, Education, Children"
            />
          </div>
        </div>

        <!-- PDF link -->
        <div>
          <label class="block text-xs font-semibold text-slate-600 mb-1" for="pdfLink">
            PDF Link (Google Drive) <span class="text-red-500">*</span>
          </label>
          <input
            id="pdfLink"
            name="pdfLink"
            type="url"
            required
            class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-blue-200"
            placeholder="https://drive.google.com/file/d/‚Ä¶"
          />
          <p class="text-xs text-slate-500 mt-1">
            Upload the PDF to Google Drive, click ‚ÄúShare ‚Üí Anyone with the link ‚Üí Viewer‚Äù, then paste the link here.
          </p>
        </div>

        <!-- Cover link -->
        <div>
          <label class="block text-xs font-semibold text-slate-600 mb-1" for="coverOriginal">
            Cover image link (Google Drive)
          </label>
          <input
            id="coverOriginal"
            name="coverOriginal"
            type="url"
            class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-blue-200"
            placeholder="https://drive.google.com/file/d/‚Ä¶"
          />
          <p class="text-xs text-slate-500 mt-1">
            The script will auto-generate a thumbnail URL for <strong>Cover Link</strong> using this file.
          </p>
        </div>

        <!-- Featured + description -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="block text-xs font-semibold text-slate-600 mb-1" for="featured">
              Featured
            </label>
            <select
              id="featured"
              name="featured"
              class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-blue-200"
            >
              <option value="">No</option>
              <option value="Yes">Yes</option>
            </select>
          </div>

          <div>
            <label class="block text-xs font-semibold text-slate-600 mb-1" for="description">
              Short description
            </label>
            <textarea
              id="description"
              name="description"
              rows="2"
              class="w-full border rounded px-3 py-2 text-sm resize-none focus:outline-none focus:ring focus:ring-blue-200"
              placeholder="Optional short description..."
            ></textarea>
          </div>
        </div>

        <div class="pt-2 flex items-center gap-3">
          <button
            id="submitBtn"
            type="submit"
            class="px-4 py-2 bg-blue-600 text-white text-sm font-semibold rounded shadow hover:bg-blue-700 disabled:opacity-60 disabled:cursor-not-allowed"
          >
            Add book
          </button>
          <span id="statusMsg" class="text-xs text-slate-500"></span>
        </div>
      </form>
    </section>
  </div>

  <script>
    // üîó Your Apps Script Web App URL (same one used in index.html & admin.html)
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwah-ItVQyz8--t-qJRTFxkuzM5Yh-KQMyvcV-bcPzOZf6jU_9oWKKMurCyoUmqYBAM/exec";

    const form      = document.getElementById("bookForm");
    const submitBtn = document.getElementById("submitBtn");
    const statusMsg = document.getElementById("statusMsg");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      statusMsg.textContent = "";
      submitBtn.disabled = true;
      submitBtn.textContent = "Adding‚Ä¶";

      const formData = new FormData(form);
      formData.append("type", "addBook");

      try {
        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams(formData)
        });

        let data;
        try {
          data = await res.json();
        } catch (parseErr) {
          const text = await res.text();
          console.error("Non-JSON response:", text);
          statusMsg.textContent = "Server returned a non-JSON response. Check console.";
          return;
        }

        if (!data.success) {
          console.error("Add book error:", data);
          statusMsg.textContent = "Error: " + (data.error || "Unknown error");
          return;
        }

        statusMsg.textContent = "‚úÖ Book added with ID " + (data.book?.id ?? "");
        form.reset();
      } catch (err) {
        console.error(err);
        statusMsg.textContent = "Network error while adding book.";
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Add book";
      }
    });
  </script>
</body>
</html>
