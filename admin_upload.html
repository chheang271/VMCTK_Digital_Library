<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VMCTK ‚Äì Add New Book</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 text-slate-800">

  <!-- üîê Login overlay (same idea as admin.html) -->
  <div
    id="adminLoginOverlay"
    class="fixed inset-0 bg-slate-900/70 flex items-center justify-center z-50"
  >
    <div class="bg-white rounded-2xl shadow-xl border border-slate-200 w-full max-w-sm p-5">
      <h2 id="loginTitleUpload" class="text-lg font-semibold text-slate-900">
        Admin login
      </h2>
      <p
        id="loginSubtitleUpload"
        class="text-xs text-slate-500 mb-3"
      >
        This page is restricted to admins only.
      </p>
      <form id="adminLoginForm" class="space-y-3">
        <div class="flex flex-col gap-1">
          <label
            id="loginUserLabelUpload"
            for="loginUserUpload"
            class="text-xs font-semibold text-slate-600"
          >
            Username
          </label>
          <input
            id="loginUserUpload"
            type="text"
            autocomplete="username"
            class="border rounded px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-blue-200"
          />
        </div>
        <div class="flex flex-col gap-1">
          <label
            id="loginPassLabelUpload"
            for="loginPassUpload"
            class="text-xs font-semibold text-slate-600"
          >
            Password
          </label>
          <input
            id="loginPassUpload"
            type="password"
            autocomplete="current-password"
            class="border rounded px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-blue-200"
          />
        </div>
        <p
          id="loginErrorUpload"
          class="text-xs text-red-600 min-h-[1rem]"
        ></p>
        <button
          id="loginButtonUpload"
          type="submit"
          class="w-full px-4 py-2 bg-blue-600 text-white text-sm font-semibold rounded shadow hover:bg-blue-700"
        >
          Log in
        </button>
      </form>
    </div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="min-h-screen max-w-3xl mx-auto px-4 py-6">
    <header class="mb-6 flex items-center justify-between gap-3 flex-wrap">
      <div>
        <h1 id="pageHeading" class="text-2xl font-bold text-slate-900 flex items-center gap-2">
          Add New Book
          <!-- tiny Admin only badge -->
          <span
            id="adminOnlyBadgeUpload"
            class="inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-semibold bg-red-100 text-red-700 border border-red-200"
          >
            Admin only
          </span>
        </h1>
        <p id="pageSubtitle" class="text-sm text-slate-500">
          This form will append a new row to <strong>Sheet1</strong> in your Google Sheet.
        </p>
      </div>

      <div class="flex items-center gap-3 text-sm">
        <!-- Language toggle -->
        <div class="inline-flex items-center rounded-full border border-slate-300 bg-slate-200 overflow-hidden">
          <button
            id="uploadEnBtn"
            type="button"
            class="px-3 py-1 text-xs flex items-center gap-1 bg-white text-slate-800 font-semibold"
          >
            <span>üá¨üáß</span><span>EN</span>
          </button>
          <button
            id="uploadKhBtn"
            type="button"
            class="px-3 py-1 text-xs flex items-center gap-1 text-slate-600"
          >
            <span>üá∞üá≠</span><span>KH</span>
          </button>
        </div>

        <a id="dashboardLink" href="admin.html" class="text-blue-600 hover:underline">
          üìä Dashboard
        </a>
        <a id="backToLibraryLink" href="index.html" class="text-blue-600 hover:underline">
          ‚Üê Back to Library
        </a>
      </div>
    </header>

    <section class="bg-white rounded-xl shadow p-5">
      <form id="bookForm" class="space-y-4">
        <!-- Admin key -->
        <div>
          <label
            id="labelAdminKey"
            class="block text-xs font-semibold text-slate-600 mb-1"
            for="adminKey"
          >
            Admin key <span class="text-red-500">*</span>
          </label>
          <input
            id="adminKey"
            name="adminKey"
            type="password"
            required
            class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-blue-200"
            placeholder="Enter the same ADMIN_KEY as in Apps Script"
          />
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label
              id="labelTitle"
              class="block text-xs font-semibold text-slate-600 mb-1"
              for="title"
            >
              Title <span class="text-red-500">*</span>
            </label>
            <input
              id="title"
              name="title"
              type="text"
              required
              class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-blue-200"
              placeholder="Book title"
            />
          </div>

          <div>
            <label
              id="labelAuthor"
              class="block text-xs font-semibold text-slate-600 mb-1"
              for="author"
            >
              Author
            </label>
            <input
              id="author"
              name="author"
              type="text"
              class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-blue-200"
              placeholder="Author name"
            />
          </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label
              id="labelLanguage"
              class="block text-xs font-semibold text-slate-600 mb-1"
              for="language"
            >
              Language
            </label>
            <select
              id="language"
              name="language"
              class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-blue-200"
            >
              <option id="optLangDefault" value="">‚Äì Select ‚Äì</option>
              <option id="optLangKhmer" value="Khmer">Khmer</option>
              <option id="optLangEnglish" value="English">English</option>
              <option id="optLangBilingual" value="Bilingual">Bilingual</option>
              <option id="optLangOther" value="Other">Other</option>
            </select>
          </div>

          <div>
            <label
              id="labelCategory"
              class="block text-xs font-semibold text-slate-600 mb-1"
              for="category"
            >
              Category
            </label>
            <input
              id="category"
              name="category"
              type="text"
              class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-blue-200"
              placeholder="e.g. Novel, Education, Children"
            />
          </div>
        </div>

        <!-- PDF link -->
        <div>
          <label
            id="labelPdfLink"
            class="block text-xs font-semibold text-slate-600 mb-1"
            for="pdfLink"
          >
            PDF Link (Google Drive) <span class="text-red-500">*</span>
          </label>
          <input
            id="pdfLink"
            name="pdfLink"
            type="url"
            required
            class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-blue-200"
            placeholder="https://drive.google.com/file/d/‚Ä¶"
          />
          <p id="helpPdfLink" class="text-xs text-slate-500 mt-1">
            Upload the PDF to Google Drive, click ‚ÄúShare ‚Üí Anyone with the link ‚Üí Viewer‚Äù, then paste the link here.
          </p>
        </div>

        <!-- Cover link -->
        <div>
          <label
            id="labelCoverOriginal"
            class="block text-xs font-semibold text-slate-600 mb-1"
            for="coverOriginal"
          >
            Cover image link (Google Drive)
          </label>
          <input
            id="coverOriginal"
            name="coverOriginal"
            type="url"
            class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-blue-200"
            placeholder="https://drive.google.com/file/d/‚Ä¶"
          />
          <p id="helpCoverOriginal" class="text-xs text-slate-500 mt-1">
            The script will auto-generate a thumbnail URL for <strong>Cover Link</strong> using this file.
          </p>
        </div>

        <!-- Featured + description -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label
              id="labelFeatured"
              class="block text-xs font-semibold text-slate-600 mb-1"
              for="featured"
            >
              Featured
            </label>
            <select
              id="featured"
              name="featured"
              class="w-full border rounded px-3 py-2 text-sm focus:outline-none focus:ring focus:ring-blue-200"
            >
              <option id="optFeaturedNo" value="">No</option>
              <option id="optFeaturedYes" value="Yes">Yes</option>
            </select>
          </div>

          <div>
            <label
              id="labelDescription"
              class="block text-xs font-semibold text-slate-600 mb-1"
              for="description"
            >
              Short description
            </label>
            <textarea
              id="description"
              name="description"
              rows="2"
              class="w-full border rounded px-3 py-2 text-sm resize-none focus:outline-none focus:ring focus:ring-blue-200"
              placeholder="Optional short description..."
            ></textarea>
          </div>
        </div>

        <div class="pt-2 flex items-center gap-3">
          <button
            id="submitBtn"
            type="submit"
            class="px-4 py-2 bg-blue-600 text-white text-sm font-semibold rounded shadow hover:bg-blue-700 disabled:opacity-60 disabled:cursor-not-allowed"
          >
            Add book
          </button>
          <span id="statusMsg" class="text-xs text-slate-500"></span>
        </div>
      </form>
    </section>
  </div>

  <script>
    // üîó Same Apps Script Web App URL
    const SCRIPT_URL =
      "https://script.google.com/macros/s/AKfycbwah-ItVQyz8--t-qJRTFxkuzM5Yh-KQMyvcV-bcPzOZf6jU_9oWKKMurCyoUmqYBAM/exec";

    // üîê Simple front-end admin login (same as admin.html)
    const ADMIN_USER = "vmcadmin";        // ‚Üê change to your username
    const ADMIN_PASS = "vmc2024";         // ‚Üê change to your password
    const LOGIN_KEY  = "vmctk_admin_logged_in";

    /*************** LANGUAGE TEXTS ***************/
    const uploadText = {
      en: {
        pageTitle: "VMCTK ‚Äì Add New Book",
        heading: "Add New Book",
        adminOnlyBadge: "Admin only",
        subtitle: 'This form will append a new row to "Sheet1" in your Google Sheet.',
        dashboardLink: "üìä Dashboard",
        backToLibrary: "‚Üê Back to Library",

        adminKeyLabel: "Admin key *",
        adminKeyPlaceholder: "Enter the same ADMIN_KEY as in Apps Script",

        titleLabel: "Title *",
        titlePlaceholder: "Book title",

        authorLabel: "Author",
        authorPlaceholder: "Author name",

        languageLabel: "Language",
        languageDefault: "‚Äì Select ‚Äì",
        languageKhmer: "Khmer",
        languageEnglish: "English",
        languageBilingual: "Bilingual",
        languageOther: "Other",

        categoryLabel: "Category",
        categoryPlaceholder: "e.g. Novel, Education, Children",

        pdfLabel: "PDF Link (Google Drive) *",
        pdfPlaceholder: "https://drive.google.com/file/d/‚Ä¶",
        pdfHelp:
          "Upload the PDF to Google Drive, click ‚ÄúShare ‚Üí Anyone with the link ‚Üí Viewer‚Äù, then paste the link here.",

        coverOriginalLabel: "Cover image link (Google Drive)",
        coverOriginalPlaceholder: "https://drive.google.com/file/d/‚Ä¶",
        coverOriginalHelp:
          "The script will auto-generate a thumbnail URL for Cover Link using this file.",

        featuredLabel: "Featured",
        featuredNo: "No",
        featuredYes: "Yes",

        descriptionLabel: "Short description",
        descriptionPlaceholder: "Optional short description...",

        buttonAdd: "Add book",
        buttonAdding: "Adding‚Ä¶",

        statusNonJson: "Server returned a non-JSON response. Check console.",
        statusErrorPrefix: "Error: ",
        statusUnknownError: "Unknown error",
        statusBookAddedPrefix: "‚úÖ Book added with ID ",
        statusNetworkError: "Network error while adding book.",

        // Login overlay
        loginTitle: "Admin login",
        loginSubtitle: "This page is restricted to admins only.",
        loginUserLabel: "Username",
        loginPassLabel: "Password",
        loginButton: "Log in",
        loginError: "Incorrect username or password."
      },
      kh: {
        pageTitle: "VMCTK ‚Äì ·ûî·ûì·üí·ûê·üÇ·ûò·ûü·üÄ·ûú·ûó·üÖ·ûê·üí·ûò·û∏",
        heading: "·ûî·ûì·üí·ûê·üÇ·ûò·ûü·üÄ·ûú·ûó·üÖ·ûê·üí·ûò·û∏",
        adminOnlyBadge: "·ûü·ûò·üí·ûö·û∂·ûî·üã Admin ·ûî·üâ·ûª·ûé·üí·ûé·üÑ·üá",
        subtitle:
          "·ûë·ûò·üí·ûö·ûÑ·üã·ûì·üÅ·üá·ûì·ûπ·ûÑ·ûî·ûì·üí·ûê·üÇ·ûò·ûá·ûΩ·ûö·ûä·üÅ·ûÄ·ûê·üí·ûò·û∏·ûë·üÖ \"Sheet1\" ·ûÄ·üí·ûì·ûª·ûÑ Google Sheet ·ûö·ûî·ûü·üã·û¢·üí·ûì·ûÄ·üî",
        dashboardLink: "üìä ·ûï·üí·ûë·û∂·üÜ·ûÑ·ûÇ·üí·ûö·ûî·üã·ûÇ·üí·ûö·ûÑ",
        backToLibrary: "‚Üê ·ûè·üí·ûö·ûõ·ûî·üã·ûë·üÖ·ûî·ûé·üí·ûé·û∂·ûõ·üê·ûô",

        adminKeyLabel: "·ûõ·üÅ·ûÅ·ûü·ûò·üí·ûÑ·û∂·ûè·üã·û¢·üí·ûì·ûÄ·ûÇ·üí·ûö·ûî·üã·ûÇ·üí·ûö·ûÑ *",
        adminKeyPlaceholder: "·ûî·ûâ·üí·ûÖ·ûº·ûõ ADMIN_KEY ·ûä·ûº·ûÖ·ûÄ·üí·ûì·ûª·ûÑ Apps Script",

        titleLabel: "·ûÖ·üÜ·ûé·ûÑ·ûá·ûæ·ûÑ *",
        titlePlaceholder: "·ûÖ·üÜ·ûé·ûÑ·ûá·ûæ·ûÑ·ûü·üÄ·ûú·ûó·üÖ",

        authorLabel: "·û¢·üí·ûì·ûÄ·ûì·û∑·ûñ·ûì·üí·ûí",
        authorPlaceholder: "·ûà·üí·ûò·üÑ·üá·û¢·üí·ûì·ûÄ·ûì·û∑·ûñ·ûì·üí·ûí",

        languageLabel: "·ûó·û∂·ûü·û∂",
        languageDefault: "‚Äì ·ûá·üí·ûö·ûæ·ûü ‚Äì",
        languageKhmer: "·ûÅ·üí·ûò·üÇ·ûö",
        languageEnglish: "·û¢·ûÑ·üã·ûÇ·üí·ûõ·üÅ·ûü",
        languageBilingual: "·ûñ·û∏·ûö·ûó·û∂·ûü·û∂",
        languageOther: "·ûï·üí·ûü·üÅ·ûÑ·ûë·üÄ·ûè",

        categoryLabel: "·ûî·üí·ûö·ûó·üÅ·ûë",
        categoryPlaceholder: "·ûß. ·ûì·û∂·ûú·ûõ, ·û¢·ûî·üã·ûö·üÜ, ·ûÄ·ûª·ûò·û∂·ûö",

        pdfLabel: "·ûè·üÜ·ûé·ûö·ûó·üí·ûá·û∂·ûî·üã PDF (Google Drive) *",
        pdfPlaceholder: "https://drive.google.com/file/d/‚Ä¶",
        pdfHelp:
          "·ûï·üí·ûë·ûª·ûÄ·ûØ·ûÄ·ûü·û∂·ûö PDF ·ûë·üÖ Google Drive ·ûî·ûì·üí·ûë·û∂·ûî·üã·ûò·ûÄ·ûÖ·ûª·ûÖ ‚ÄúShare ‚Üí Anyone with the link ‚Üí Viewer‚Äù ·û†·ûæ·ûô·ûî·û∑·ûë·ûó·üí·ûá·û∂·ûî·üã·ûè·üÜ·ûé·ûì·üÖ·ûë·û∏·ûì·üÅ·üá·üî",

        coverOriginalLabel: "·ûè·üÜ·ûé·ûö·ûÇ·ûò·üí·ûö·ûî·ûü·üÄ·ûú·ûó·üÖ (Google Drive)",
        coverOriginalPlaceholder: "https://drive.google.com/file/d/‚Ä¶",
        coverOriginalHelp:
          "Script ·ûì·ûπ·ûÑ·ûî·ûÑ·üí·ûÄ·ûæ·ûè URL ·ûö·ûº·ûî·ûè·ûº·ûÖ·ûü·ûò·üí·ûö·û∂·ûî·üã Cover Link ·ûä·üÑ·ûô·ûü·üí·ûú·üê·ûô·ûî·üí·ûö·ûú·ûè·üí·ûè·û∑·ûñ·û∏·ûØ·ûÄ·ûü·û∂·ûö·ûì·üÅ·üá·üî",

        featuredLabel: "·ûü·üÄ·ûú·ûó·üÖ·ûñ·û∑·ûü·üÅ·ûü",
        featuredNo: "·ûë·üÅ",
        featuredYes: "·ûî·û∂·ûë/·ûÖ·û∂·ûü",

        descriptionLabel: "·ûñ·ûé·üå·ûì·û∂·ûÅ·üí·ûõ·û∏",
        descriptionPlaceholder: "·ûñ·ûé·üå·ûì·û∂·ûÅ·üí·ûõ·û∏·û¢·üÜ·ûñ·û∏·ûü·üÄ·ûú·ûó·üÖ (·ûò·û∑·ûì·ûÖ·û∂·üÜ·ûî·û∂·ûÖ·üã)...",

        buttonAdd: "·ûî·ûì·üí·ûê·üÇ·ûò·ûü·üÄ·ûú·ûó·üÖ",
        buttonAdding: "·ûÄ·üÜ·ûñ·ûª·ûÑ·ûî·ûì·üí·ûê·üÇ·ûò...",

        statusNonJson: "·ûò·üâ·û∂·ûü·üä·û∏·ûì·ûò·üÅ·ûò·û∑·ûì·ûÜ·üí·ûõ·ûæ·ûô·ûè·ûî·ûá·û∂ JSON ·ûë·üÅ·üî ·ûü·ûº·ûò·ûñ·û∑·ûì·û∑·ûè·üí·ûô Console·üî",
        statusErrorPrefix: "·ûÄ·üÜ·û†·ûª·ûü·üñ ",
        statusUnknownError: "·ûò·û∑·ûì·ûä·ûπ·ûÑ·ûò·ûº·ûõ·û†·üÅ·ûè·ûª",
        statusBookAddedPrefix: "‚úÖ ·ûî·û∂·ûì·ûî·ûì·üí·ûê·üÇ·ûò·ûü·üÄ·ûú·ûó·üÖ·ûá·û∂·ûò·ûΩ·ûô ID ",
        statusNetworkError: "·ûî·ûâ·üí·û†·û∂·ûî·ûé·üí·ûä·û∂·ûâ·ûñ·üÅ·ûõ·ûî·ûì·üí·ûê·üÇ·ûò·ûü·üÄ·ûú·ûó·üÖ·üî",

        // Login overlay
        loginTitle: "·ûÖ·ûº·ûõ·ûî·üí·ûö·ûæ·ûü·ûò·üí·ûö·û∂·ûî·üã Admin",
        loginSubtitle: "·ûë·üÜ·ûñ·üê·ûö·ûì·üÅ·üá·ûü·ûò·üí·ûö·û∂·ûî·üã·û¢·üí·ûì·ûÄ·ûÇ·üí·ûö·ûî·üã·ûÇ·üí·ûö·ûÑ·ûî·üâ·ûª·ûé·üí·ûé·üÑ·üá·üî",
        loginUserLabel: "·ûà·üí·ûò·üÑ·üá·û¢·üí·ûì·ûÄ·ûî·üí·ûö·ûæ",
        loginPassLabel: "·ûñ·û∂·ûÄ·üí·ûô·ûü·ûò·üí·ûÑ·û∂·ûè·üã",
        loginButton: "·ûÖ·ûº·ûõ·ûî·üí·ûö·ûæ",
        loginError: "·ûà·üí·ûò·üÑ·üá·û¢·üí·ûì·ûÄ·ûî·üí·ûö·ûæ ·û¨ ·ûñ·û∂·ûÄ·üí·ûô·ûü·ûò·üí·ûÑ·û∂·ûè·üã ·ûò·û∑·ûì·ûè·üí·ûö·ûπ·ûò·ûè·üí·ûö·ûº·ûú·üî"
      }
    };

    // Shared with admin.html so language stays in sync
    let currentLang = localStorage.getItem("vmctk_admin_lang") || "en";

    function applyUploadLanguage() {
      const t = uploadText[currentLang] || uploadText.en;

      document.title = t.pageTitle;

      const headingEl = document.getElementById("pageHeading");
      const subtitleEl = document.getElementById("pageSubtitle");
      const dashboardLink = document.getElementById("dashboardLink");
      const backToLibrary = document.getElementById("backToLibraryLink");
      const adminBadge = document.getElementById("adminOnlyBadgeUpload");

      if (headingEl) headingEl.textContent = t.heading;
      if (adminBadge) adminBadge.textContent = t.adminOnlyBadge;
      if (subtitleEl) subtitleEl.textContent = t.subtitle;
      if (dashboardLink) dashboardLink.textContent = t.dashboardLink;
      if (backToLibrary) backToLibrary.textContent = t.backToLibrary;

      const setText = (id, value) => {
        const el = document.getElementById(id);
        if (el) el.textContent = value;
      };

      setText("labelAdminKey", t.adminKeyLabel);
      setText("labelTitle", t.titleLabel);
      setText("labelAuthor", t.authorLabel);
      setText("labelLanguage", t.languageLabel);
      setText("labelCategory", t.categoryLabel);
      setText("labelPdfLink", t.pdfLabel);
      setText("labelCoverOriginal", t.coverOriginalLabel);
      setText("labelFeatured", t.featuredLabel);
      setText("labelDescription", t.descriptionLabel);

      const adminKeyInput = document.getElementById("adminKey");
      const titleInput = document.getElementById("title");
      const authorInput = document.getElementById("author");
      const categoryInput = document.getElementById("category");
      const pdfInput = document.getElementById("pdfLink");
      const coverOrigInput = document.getElementById("coverOriginal");
      const descriptionInput = document.getElementById("description");

      if (adminKeyInput) adminKeyInput.placeholder = t.adminKeyPlaceholder;
      if (titleInput) titleInput.placeholder = t.titlePlaceholder;
      if (authorInput) authorInput.placeholder = t.authorPlaceholder;
      if (categoryInput) categoryInput.placeholder = t.categoryPlaceholder;
      if (pdfInput) pdfInput.placeholder = t.pdfPlaceholder;
      if (coverOrigInput) coverOrigInput.placeholder = t.coverOriginalPlaceholder;
      if (descriptionInput) descriptionInput.placeholder = t.descriptionPlaceholder;

      const helpPdf = document.getElementById("helpPdfLink");
      const helpCover = document.getElementById("helpCoverOriginal");
      if (helpPdf) helpPdf.textContent = t.pdfHelp;
      if (helpCover) helpCover.textContent = t.coverOriginalHelp;

      const optDefault = document.getElementById("optLangDefault");
      const optKhmer = document.getElementById("optLangKhmer");
      const optEnglish = document.getElementById("optLangEnglish");
      const optBilingual = document.getElementById("optLangBilingual");
      const optOther = document.getElementById("optLangOther");

      if (optDefault) optDefault.textContent = t.languageDefault;
      if (optKhmer) optKhmer.textContent = t.languageKhmer;
      if (optEnglish) optEnglish.textContent = t.languageEnglish;
      if (optBilingual) optBilingual.textContent = t.languageBilingual;
      if (optOther) optOther.textContent = t.languageOther;

      const optFeatNo = document.getElementById("optFeaturedNo");
      const optFeatYes = document.getElementById("optFeaturedYes");
      if (optFeatNo) optFeatNo.textContent = t.featuredNo;
      if (optFeatYes) optFeatYes.textContent = t.featuredYes;

      const submitBtn = document.getElementById("submitBtn");
      if (submitBtn) submitBtn.textContent = t.buttonAdd;

      // Login overlay text
      setText("loginTitleUpload", t.loginTitle);
      setText("loginSubtitleUpload", t.loginSubtitle);
      setText("loginUserLabelUpload", t.loginUserLabel);
      setText("loginPassLabelUpload", t.loginPassLabel);
      setText("loginButtonUpload", t.loginButton);

      // Language toggle visuals
      const enBtn = document.getElementById("uploadEnBtn");
      const khBtn = document.getElementById("uploadKhBtn");
      if (enBtn && khBtn) {
        if (currentLang === "en") {
          enBtn.classList.add("bg-white", "text-slate-800", "font-semibold");
          khBtn.classList.remove("bg-white", "text-slate-800", "font-semibold");
          khBtn.classList.add("text-slate-600");
        } else {
          khBtn.classList.add("bg-white", "text-slate-800", "font-semibold");
          enBtn.classList.remove("bg-white", "text-slate-800", "font-semibold");
          enBtn.classList.add("text-slate-600");
        }
      }
    }

    /*************** SIMPLE LOGIN ***************/
    function setupLogin() {
      const overlay = document.getElementById("adminLoginOverlay");
      const form = document.getElementById("adminLoginForm");
      const errorEl = document.getElementById("loginErrorUpload");
      if (!overlay || !form) return;

      const loggedIn = localStorage.getItem(LOGIN_KEY) === "yes";
      if (loggedIn) {
        overlay.classList.add("hidden");
      }

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const t = uploadText[currentLang] || uploadText.en;
        const user = document.getElementById("loginUserUpload").value.trim();
        const pass = document.getElementById("loginPassUpload").value;
        if (user === ADMIN_USER && pass === ADMIN_PASS) {
          localStorage.setItem(LOGIN_KEY, "yes");
          overlay.classList.add("hidden");
          errorEl.textContent = "";
        } else {
          errorEl.textContent = t.loginError;
        }
      });
    }

    /*************** FORM SUBMIT ***************/
    const form = document.getElementById("bookForm");
    const submitBtn = document.getElementById("submitBtn");
    const statusMsg = document.getElementById("statusMsg");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const t = uploadText[currentLang] || uploadText.en;

      statusMsg.textContent = "";
      submitBtn.disabled = true;
      submitBtn.textContent = t.buttonAdding;

      const formData = new FormData(form);

      // NOTE: this type matches Apps Script: 'admin-add-book'
      formData.append("type", "admin-add-book");

      try {
        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams(formData)
        });

        let data;
        try {
          data = await res.json();
        } catch (parseErr) {
          const text = await res.text();
          console.error("Non-JSON response:", text);
          statusMsg.textContent = t.statusNonJson;
          return;
        }

        if (!data.success) {
          console.error("Add book error:", data);
          const msg =
            t.statusErrorPrefix + (data.error || t.statusUnknownError);
          statusMsg.textContent = msg;
          return;
        }

        const newId = data.id ?? (data.book && data.book.id) ?? "";
        statusMsg.textContent = t.statusBookAddedPrefix + newId;
        form.reset();
      } catch (err) {
        console.error(err);
        const tNow = uploadText[currentLang] || uploadText.en;
        statusMsg.textContent = tNow.statusNetworkError;
      } finally {
        const tNow = uploadText[currentLang] || uploadText.en;
        submitBtn.disabled = false;
        submitBtn.textContent = tNow.buttonAdd;
      }
    });

    /*************** LANGUAGE TOGGLE EVENTS ***************/
    const uploadEnBtn = document.getElementById("uploadEnBtn");
    const uploadKhBtn = document.getElementById("uploadKhBtn");

    uploadEnBtn.addEventListener("click", () => {
      currentLang = "en";
      localStorage.setItem("vmctk_admin_lang", currentLang);
      applyUploadLanguage();
    });

    uploadKhBtn.addEventListener("click", () => {
      currentLang = "kh";
      localStorage.setItem("vmctk_admin_lang", currentLang);
      applyUploadLanguage();
    });

    // Initial load
    applyUploadLanguage();
    setupLogin();
  </script>
</body>
</html>
